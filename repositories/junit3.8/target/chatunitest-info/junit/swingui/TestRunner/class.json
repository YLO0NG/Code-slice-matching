{
  "fullClassName": "junit.swingui.TestRunner",
  "className": "TestRunner",
  "index": 44,
  "modifier": "[public ]",
  "extend": "[BaseTestRunner]",
  "implement": "[TestRunContext]",
  "packageName": "junit.swingui",
  "packageDeclaration": "package junit.swingui;",
  "classSignature": "public class TestRunner",
  "hasConstructor": true,
  "isPublic": true,
  "isInterface": false,
  "isAbstract": false,
  "imports": [
    "import java.awt.*;",
    "import java.awt.event.*;",
    "import java.io.*;",
    "import java.net.URL;",
    "import java.util.*;",
    "import javax.swing.*;",
    "import javax.swing.event.*;",
    "import junit.framework.*;",
    "import junit.runner.*;"
  ],
  "fields": [
    "private static Font PLAIN_FONT= StatusLine.PLAIN_FONT;",
    "private static Font BOLD_FONT= StatusLine.BOLD_FONT;",
    "private static final int GAP= 4;",
    "private static final int HISTORY_LENGTH= 5;",
    "protected JFrame fFrame;",
    "private Thread fRunner;",
    "private TestResult fTestResult;",
    "private JComboBox fSuiteCombo;",
    "private ProgressBar fProgressIndicator;",
    "private DefaultListModel fFailures;",
    "private JLabel fLogo;",
    "private CounterPanel fCounterPanel;",
    "private JButton fRun;",
    "private JButton fQuitButton;",
    "private JButton fRerunButton;",
    "private StatusLine fStatusLine;",
    "private FailureDetailView fFailureView;",
    "private JTabbedPane fTestViewTab;",
    "private JCheckBox fUseLoadingRunner;",
    "private Vector fTestRunViews= new Vector();",
    "private static final String TESTCOLLECTOR_KEY= \"TestCollectorClass\";",
    "private static final String FAILUREDETAILVIEW_KEY= \"FailureViewClass\";"
  ],
  "superClasses": [
    "BaseTestRunner"
  ],
  "implementedTypes": [
    "TestRunContext"
  ],
  "methodSigs": {
    "main(String[])": "0",
    "run(Class)": "1",
    "testFailed(int, Test, Throwable)": "2",
    "testStarted(String)": "3",
    "testEnded(String)": "4",
    "setSuite(String)": "5",
    "addToHistory(String)": "6",
    "pruneHistory()": "7",
    "appendFailure(String, Test, Throwable)": "8",
    "revealFailure(Test)": "9",
    "aboutToStart(Test)": "10",
    "runFinished(Test)": "11",
    "createCounterPanel()": "12",
    "createFailedPanel()": "13",
    "createFailureDetailView()": "14",
    "createJUnitMenu()": "15",
    "createFrame(String)": "16",
    "createLogo()": "17",
    "createMenus(JMenuBar)": "18",
    "createUseLoaderCheckBox()": "19",
    "createQuitButton()": "20",
    "createRunButton()": "21",
    "createBrowseButton()": "22",
    "createStatusLine()": "23",
    "createSuiteCombo()": "24",
    "createTestRunViews()": "25",
    "testViewChanged()": "26",
    "createTestResult()": "27",
    "createUI(String)": "28",
    "addGrid(JPanel, Component, int, int, int, int, double, int)": "29",
    "getSuiteText()": "30",
    "getFailures()": "31",
    "insertUpdate(DocumentEvent)": "32",
    "browseTestClasses()": "33",
    "createTestCollector()": "34",
    "loadFrameIcon()": "35",
    "loadHistory(JComboBox)": "36",
    "getSettingsFile()": "37",
    "postInfo(String)": "38",
    "postStatus(String)": "39",
    "removeUpdate(DocumentEvent)": "40",
    "rerun()": "41",
    "rerunTest(Test)": "42",
    "reset()": "43",
    "runFailed(String)": "44",
    "runSuite()": "45",
    "shouldReload()": "46",
    "runTest(Test)": "47",
    "doRunTest(Test)": "48",
    "saveHistory()": "49",
    "setButtonLabel(JButton, String)": "50",
    "setLabelValue(JTextField, int)": "51",
    "handleTestSelected(Test)": "52",
    "showFailureDetail(Test)": "53",
    "showInfo(String)": "54",
    "showStatus(String)": "55",
    "start(String[])": "56",
    "start(Test)": "57",
    "synchUI()": "58",
    "terminate()": "59",
    "textChanged()": "60",
    "clearStatus()": "61",
    "getIconResource(Class, String)": "62",
    "about()": "63",
    "TestRunner()": "64"
  },
  "methodsBrief": [
    "public static void main(String[] args){}",
    "public static void run(Class test){}",
    "public void testFailed(final int status, final Test test, final Throwable t){}",
    "public void testStarted(String testName){}",
    "public void testEnded(String stringName){}",
    "public void setSuite(String suiteName){}",
    "private void addToHistory(final String suite){}",
    "private void pruneHistory(){}",
    "private void appendFailure(String kind, Test test, Throwable t){}",
    "private void revealFailure(Test test){}",
    "protected void aboutToStart(final Test testSuite){}",
    "protected void runFinished(final Test testSuite){}",
    "protected CounterPanel createCounterPanel(){}",
    "protected JPanel createFailedPanel(){}",
    "protected FailureDetailView createFailureDetailView(){}",
    "protected JMenu createJUnitMenu(){}",
    "protected JFrame createFrame(String title){}",
    "protected JLabel createLogo(){}",
    "protected void createMenus(JMenuBar mb){}",
    "protected JCheckBox createUseLoaderCheckBox(){}",
    "protected JButton createQuitButton(){}",
    "protected JButton createRunButton(){}",
    "protected Component createBrowseButton(){}",
    "protected StatusLine createStatusLine(){}",
    "protected JComboBox createSuiteCombo(){}",
    "protected JTabbedPane createTestRunViews(){}",
    "public void testViewChanged(){}",
    "protected TestResult createTestResult(){}",
    "protected JFrame createUI(String suiteName){}",
    "private void addGrid(JPanel p, Component co, int x, int y, int w, int fill, double wx, int anchor){}",
    "protected String getSuiteText(){}",
    "public ListModel getFailures(){}",
    "public void insertUpdate(DocumentEvent event){}",
    "public void browseTestClasses(){}",
    "TestCollector createTestCollector(){}",
    "private Image loadFrameIcon(){}",
    "private void loadHistory(JComboBox combo) throws IOException{}",
    "private File getSettingsFile(){}",
    "private void postInfo(final String message){}",
    "private void postStatus(final String status){}",
    "public void removeUpdate(DocumentEvent event){}",
    "private void rerun(){}",
    "private void rerunTest(Test test){}",
    "protected void reset(){}",
    "protected void runFailed(String message){}",
    "synchronized public void runSuite(){}",
    "private boolean shouldReload(){}",
    "synchronized protected void runTest(final Test testSuite){}",
    "private void doRunTest(final Test testSuite){}",
    "private void saveHistory() throws IOException{}",
    "private void setButtonLabel(final JButton button, final String label){}",
    "private void setLabelValue(final JTextField label, final int value){}",
    "public void handleTestSelected(Test test){}",
    "private void showFailureDetail(Test test){}",
    "private void showInfo(String message){}",
    "private void showStatus(String status){}",
    "public void start(String[] args){}",
    "private void start(final Test test){}",
    "private void synchUI(){}",
    "public void terminate(){}",
    "public void textChanged(){}",
    "protected void clearStatus(){}",
    "public static Icon getIconResource(Class clazz, String name){}",
    "private void about(){}",
    "public TestRunner(){}"
  ],
  "constructorSigs": [
    "TestRunner()"
  ],
  "constructorBrief": [
    "public TestRunner(){}"
  ],
  "getterSetterSigs": [
    "setSuite(String)",
    "getSuiteText()",
    "getFailures()",
    "getSettingsFile()",
    "setButtonLabel(JButton, String)",
    "setLabelValue(JTextField, int)"
  ],
  "getterSetterBrief": [
    "public void setSuite(String suiteName){}",
    "protected String getSuiteText(){}",
    "public ListModel getFailures(){}",
    "private File getSettingsFile(){}",
    "private void setButtonLabel(final JButton button, final String label){}",
    "private void setLabelValue(final JTextField label, final int value){}"
  ],
  "constructorDeps": {},
  "compilationUnitCode": "package junit.swingui;\r\n\r\nimport java.awt.*;\r\nimport java.awt.event.*;\r\nimport java.io.*;\r\nimport java.net.URL;\r\nimport java.util.*;\r\nimport javax.swing.*;\r\nimport javax.swing.event.*;\r\nimport junit.framework.*;\r\nimport junit.runner.*;\r\n\r\n/**\r\n * A Swing based user interface to run tests.\r\n * Enter the name of a class which either provides a static\r\n * suite method or is a subclass of TestCase.\r\n * <pre>\r\n * Synopsis: java junit.swingui.TestRunner [-noloading] [TestCase]\r\n * </pre>\r\n * TestRunner takes as an optional argument the name of the testcase class to be run.\r\n */\r\npublic class TestRunner extends BaseTestRunner implements TestRunContext {\r\n\r\n    private static Font PLAIN_FONT = StatusLine.PLAIN_FONT;\r\n\r\n    private static Font BOLD_FONT = StatusLine.BOLD_FONT;\r\n\r\n    private static final int GAP = 4;\r\n\r\n    private static final int HISTORY_LENGTH = 5;\r\n\r\n    protected JFrame fFrame;\r\n\r\n    private Thread fRunner;\r\n\r\n    private TestResult fTestResult;\r\n\r\n    private JComboBox fSuiteCombo;\r\n\r\n    private ProgressBar fProgressIndicator;\r\n\r\n    private DefaultListModel fFailures;\r\n\r\n    private JLabel fLogo;\r\n\r\n    private CounterPanel fCounterPanel;\r\n\r\n    private JButton fRun;\r\n\r\n    private JButton fQuitButton;\r\n\r\n    private JButton fRerunButton;\r\n\r\n    private StatusLine fStatusLine;\r\n\r\n    private FailureDetailView fFailureView;\r\n\r\n    private JTabbedPane fTestViewTab;\r\n\r\n    private JCheckBox fUseLoadingRunner;\r\n\r\n    // view associated with tab in tabbed pane\r\n    private Vector fTestRunViews = new Vector();\r\n\r\n    private static final String TESTCOLLECTOR_KEY = \"TestCollectorClass\";\r\n\r\n    private static final String FAILUREDETAILVIEW_KEY = \"FailureViewClass\";\r\n\r\n    public TestRunner() {\r\n    }\r\n\r\n    public static void main(String[] args) {\r\n        new TestRunner().start(args);\r\n    }\r\n\r\n    public static void run(Class test) {\r\n        String[] args = { test.getName() };\r\n        main(args);\r\n    }\r\n\r\n    public void testFailed(final int status, final Test test, final Throwable t) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                switch(status) {\r\n                    case TestRunListener.STATUS_ERROR:\r\n                        fCounterPanel.setErrorValue(fTestResult.errorCount());\r\n                        /*{*/\r\n                        fFailures.addElement(new TestFailure(test, t));\r\n                        if (fFailures.size() == 1)\r\n                            revealFailure(test);\r\n                        /*}*/\r\n                        break;\r\n                    case TestRunListener.STATUS_FAILURE:\r\n                        fCounterPanel.setFailureValue(fTestResult.failureCount());\r\n                        appendFailure(\"Failure\", test, t);\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public void testStarted(String testName) {\r\n        postInfo(\"Running: \" + testName);\r\n    }\r\n\r\n    public void testEnded(String stringName) {\r\n        synchUI();\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                if (fTestResult != null) {\r\n                    fCounterPanel.setRunValue(fTestResult.runCount());\r\n                    fProgressIndicator.step(fTestResult.runCount(), fTestResult.wasSuccessful());\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public void setSuite(String suiteName) {\r\n        fSuiteCombo.getEditor().setItem(suiteName);\r\n    }\r\n\r\n    private void addToHistory(final String suite) {\r\n        for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n            if (suite.equals(fSuiteCombo.getItemAt(i))) {\r\n                fSuiteCombo.removeItemAt(i);\r\n                fSuiteCombo.insertItemAt(suite, 0);\r\n                fSuiteCombo.setSelectedIndex(0);\r\n                return;\r\n            }\r\n        }\r\n        fSuiteCombo.insertItemAt(suite, 0);\r\n        fSuiteCombo.setSelectedIndex(0);\r\n        /*{*/\r\n        int historyLength = getPreference(\"maxhistory\", HISTORY_LENGTH);\r\n        if (historyLength < 1)\r\n            historyLength = 1;\r\n        for (int i = fSuiteCombo.getItemCount() - 1; i > historyLength - 1; i--) fSuiteCombo.removeItemAt(i);\r\n        /*}*/\r\n    }\r\n\r\n    private void pruneHistory() {\r\n        int historyLength = getPreference(\"maxhistory\", HISTORY_LENGTH);\r\n        if (historyLength < 1)\r\n            historyLength = 1;\r\n        for (int i = fSuiteCombo.getItemCount() - 1; i > historyLength - 1; i--) fSuiteCombo.removeItemAt(i);\r\n    }\r\n\r\n    private void appendFailure(String kind, Test test, Throwable t) {\r\n        fFailures.addElement(new TestFailure(test, t));\r\n        if (fFailures.size() == 1)\r\n            revealFailure(test);\r\n    }\r\n\r\n    private void revealFailure(Test test) {\r\n        for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n            TestRunView v = (TestRunView) e.nextElement();\r\n            v.revealFailure(test);\r\n        }\r\n    }\r\n\r\n    protected void aboutToStart(final Test testSuite) {\r\n        for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n            TestRunView v = (TestRunView) e.nextElement();\r\n            v.aboutToStart(testSuite, fTestResult);\r\n        }\r\n    }\r\n\r\n    protected void runFinished(final Test testSuite) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n                    TestRunView v = (TestRunView) e.nextElement();\r\n                    v.runFinished(testSuite, fTestResult);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected CounterPanel createCounterPanel() {\r\n        return new CounterPanel();\r\n    }\r\n\r\n    protected JPanel createFailedPanel() {\r\n        JPanel failedPanel = new JPanel(new GridLayout(0, 1, 0, 2));\r\n        fRerunButton = new JButton(\"Run\");\r\n        fRerunButton.setEnabled(false);\r\n        fRerunButton.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n                Test rerunTest = view.getSelectedTest();\r\n                if (rerunTest != null)\r\n                    rerunTest(rerunTest);\r\n                /*}*/\r\n            }\r\n        });\r\n        failedPanel.add(fRerunButton);\r\n        return failedPanel;\r\n    }\r\n\r\n    protected FailureDetailView createFailureDetailView() {\r\n        String className = BaseTestRunner.getPreference(FAILUREDETAILVIEW_KEY);\r\n        if (className != null) {\r\n            Class viewClass = null;\r\n            try {\r\n                viewClass = Class.forName(className);\r\n                return (FailureDetailView) viewClass.newInstance();\r\n            } catch (Exception e) {\r\n                JOptionPane.showMessageDialog(fFrame, \"Could not create Failure DetailView - using default view\");\r\n            }\r\n        }\r\n        return new DefaultFailureDetailView();\r\n    }\r\n\r\n    /**\r\n     * Creates the JUnit menu. Clients override this\r\n     * method to add additional menu items.\r\n     */\r\n    protected JMenu createJUnitMenu() {\r\n        JMenu menu = new JMenu(\"JUnit\");\r\n        menu.setMnemonic('J');\r\n        JMenuItem mi1 = new JMenuItem(\"About...\");\r\n        mi1.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent event) {\r\n                about();\r\n            }\r\n        });\r\n        mi1.setMnemonic('A');\r\n        menu.add(mi1);\r\n        menu.addSeparator();\r\n        JMenuItem mi2 = new JMenuItem(\" Exit \");\r\n        mi2.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent event) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        mi2.setMnemonic('x');\r\n        menu.add(mi2);\r\n        return menu;\r\n    }\r\n\r\n    protected JFrame createFrame(String title) {\r\n        JFrame frame = new JFrame(\"JUnit\");\r\n        Image icon = loadFrameIcon();\r\n        if (icon != null)\r\n            frame.setIconImage(icon);\r\n        frame.getContentPane().setLayout(new BorderLayout(0, 0));\r\n        frame.addWindowListener(new WindowAdapter() {\r\n\r\n            public void windowClosing(WindowEvent e) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e1) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        return frame;\r\n    }\r\n\r\n    protected JLabel createLogo() {\r\n        JLabel label;\r\n        Icon icon = getIconResource(BaseTestRunner.class, \"logo.gif\");\r\n        if (icon != null)\r\n            label = new JLabel(icon);\r\n        else\r\n            label = new JLabel(\"JV\");\r\n        label.setToolTipText(\"JUnit Version \" + Version.id());\r\n        return label;\r\n    }\r\n\r\n    protected void createMenus(JMenuBar mb) {\r\n        mb.add(createJUnitMenu());\r\n    }\r\n\r\n    protected JCheckBox createUseLoaderCheckBox() {\r\n        boolean useLoader = useReloadingTestSuiteLoader();\r\n        JCheckBox box = new JCheckBox(\"Reload classes every run\", useLoader);\r\n        box.setToolTipText(\"Use a custom class loader to reload the classes for every run\");\r\n        if (inVAJava())\r\n            box.setVisible(false);\r\n        return box;\r\n    }\r\n\r\n    protected JButton createQuitButton() {\r\n        // spaces required to avoid layout flicker\r\n        // Exit is shorter than Stop that shows in the same column\r\n        JButton quit = new JButton(\" Exit \");\r\n        quit.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e1) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        return quit;\r\n    }\r\n\r\n    protected JButton createRunButton() {\r\n        JButton run = new JButton(\"Run\");\r\n        run.setEnabled(true);\r\n        run.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                if (fRunner != null) {\r\n                    fTestResult.stop();\r\n                } else {\r\n                    setLoading(shouldReload());\r\n                    reset();\r\n                    showInfo(\"Load Test Case...\");\r\n                    final String suiteName = getSuiteText();\r\n                    final Test testSuite = getTest(suiteName);\r\n                    if (testSuite != null) {\r\n                        addToHistory(suiteName);\r\n                        doRunTest(testSuite);\r\n                    }\r\n                }\r\n                /*}*/\r\n            }\r\n        });\r\n        return run;\r\n    }\r\n\r\n    protected Component createBrowseButton() {\r\n        JButton browse = new JButton(\"...\");\r\n        browse.setToolTipText(\"Select a Test class\");\r\n        browse.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                browseTestClasses();\r\n            }\r\n        });\r\n        return browse;\r\n    }\r\n\r\n    protected StatusLine createStatusLine() {\r\n        return new StatusLine(380);\r\n    }\r\n\r\n    protected JComboBox createSuiteCombo() {\r\n        JComboBox combo = new JComboBox();\r\n        combo.setEditable(true);\r\n        combo.setLightWeightPopupEnabled(false);\r\n        combo.getEditor().getEditorComponent().addKeyListener(new KeyAdapter() {\r\n\r\n            public void keyTyped(KeyEvent e) {\r\n                textChanged();\r\n                if (e.getKeyChar() == KeyEvent.VK_ENTER)\r\n                    /*{*/\r\n                    if (fRunner != null) {\r\n                        fTestResult.stop();\r\n                    } else {\r\n                        setLoading(shouldReload());\r\n                        reset();\r\n                        showInfo(\"Load Test Case...\");\r\n                        final String suiteName = getSuiteText();\r\n                        final Test testSuite = getTest(suiteName);\r\n                        if (testSuite != null) {\r\n                            addToHistory(suiteName);\r\n                            doRunTest(testSuite);\r\n                        }\r\n                    }\r\n                /*}*/\r\n            }\r\n        });\r\n        try {\r\n            loadHistory(combo);\r\n        } catch (IOException e) {\r\n            // fails the first time\r\n        }\r\n        combo.addItemListener(new ItemListener() {\r\n\r\n            public void itemStateChanged(ItemEvent event) {\r\n                if (event.getStateChange() == ItemEvent.SELECTED) {\r\n                    textChanged();\r\n                }\r\n            }\r\n        });\r\n        return combo;\r\n    }\r\n\r\n    protected JTabbedPane createTestRunViews() {\r\n        JTabbedPane pane = new JTabbedPane(JTabbedPane.BOTTOM);\r\n        FailureRunView lv = new FailureRunView(this);\r\n        fTestRunViews.addElement(lv);\r\n        lv.addTab(pane);\r\n        TestHierarchyRunView tv = new TestHierarchyRunView(this);\r\n        fTestRunViews.addElement(tv);\r\n        tv.addTab(pane);\r\n        pane.addChangeListener(new ChangeListener() {\r\n\r\n            public void stateChanged(ChangeEvent e) {\r\n                testViewChanged();\r\n            }\r\n        });\r\n        return pane;\r\n    }\r\n\r\n    public void testViewChanged() {\r\n        TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n        view.activate();\r\n    }\r\n\r\n    protected TestResult createTestResult() {\r\n        return new TestResult();\r\n    }\r\n\r\n    protected JFrame createUI(String suiteName) {\r\n        JFrame frame = createFrame(\"JUnit\");\r\n        JMenuBar mb = new JMenuBar();\r\n        createMenus(mb);\r\n        frame.setJMenuBar(mb);\r\n        JLabel suiteLabel = new JLabel(\"Test class name:\");\r\n        fSuiteCombo = createSuiteCombo();\r\n        fRun = createRunButton();\r\n        frame.getRootPane().setDefaultButton(fRun);\r\n        Component browseButton = createBrowseButton();\r\n        fUseLoadingRunner = createUseLoaderCheckBox();\r\n        fProgressIndicator = new ProgressBar();\r\n        fCounterPanel = createCounterPanel();\r\n        fFailures = new DefaultListModel();\r\n        fTestViewTab = createTestRunViews();\r\n        JPanel failedPanel = createFailedPanel();\r\n        fFailureView = createFailureDetailView();\r\n        JScrollPane tracePane = new JScrollPane(fFailureView.getComponent(), JScrollPane.VERTICAL_SCROLLBAR_ALWAYS, JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);\r\n        fStatusLine = createStatusLine();\r\n        fQuitButton = createQuitButton();\r\n        fLogo = createLogo();\r\n        JPanel panel = new JPanel(new GridBagLayout());\r\n        /*{*/\r\n        int fill = GridBagConstraints.HORIZONTAL;\r\n        GridBagConstraints c = new GridBagConstraints();\r\n        c.gridx = 0;\r\n        c.gridy = 0;\r\n        c.gridwidth = 2;\r\n        c.anchor = GridBagConstraints.WEST;\r\n        c.weightx = 1.0;\r\n        c.fill = fill;\r\n        if (fill == GridBagConstraints.BOTH || fill == GridBagConstraints.VERTICAL)\r\n            c.weighty = 1.0;\r\n        c.insets = new Insets(0 == 0 ? 10 : 0, 0 == 0 ? 10 : GAP, GAP, GAP);\r\n        panel.add(suiteLabel, c);\r\n        /*}*/\r\n        addGrid(panel, fSuiteCombo, 0, 1, 1, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, browseButton, 1, 1, 1, GridBagConstraints.NONE, 0.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fRun, 2, 1, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.CENTER);\r\n        addGrid(panel, fUseLoadingRunner, 0, 2, 3, GridBagConstraints.NONE, 1.0, GridBagConstraints.WEST);\r\n        // addGrid(panel, new JSeparator(), \t0, 3, 3, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fProgressIndicator, 0, 3, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fLogo, 2, 3, 1, GridBagConstraints.NONE, 0.0, GridBagConstraints.NORTH);\r\n        addGrid(panel, fCounterPanel, 0, 4, 2, GridBagConstraints.NONE, 0.0, GridBagConstraints.WEST);\r\n        addGrid(panel, new JSeparator(), 0, 5, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, new JLabel(\"Results:\"), 0, 6, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        JSplitPane splitter = new JSplitPane(JSplitPane.VERTICAL_SPLIT, fTestViewTab, tracePane);\r\n        addGrid(panel, splitter, 0, 7, 2, GridBagConstraints.BOTH, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, failedPanel, 2, 7, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.NORTH);\r\n        addGrid(panel, fStatusLine, 0, 9, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.CENTER);\r\n        addGrid(panel, fQuitButton, 2, 9, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.CENTER);\r\n        frame.setContentPane(panel);\r\n        frame.pack();\r\n        frame.setLocation(200, 200);\r\n        return frame;\r\n    }\r\n\r\n    private void addGrid(JPanel p, Component co, int x, int y, int w, int fill, double wx, int anchor) {\r\n        GridBagConstraints c = new GridBagConstraints();\r\n        c.gridx = x;\r\n        c.gridy = y;\r\n        c.gridwidth = w;\r\n        c.anchor = anchor;\r\n        c.weightx = wx;\r\n        c.fill = fill;\r\n        if (fill == GridBagConstraints.BOTH || fill == GridBagConstraints.VERTICAL)\r\n            c.weighty = 1.0;\r\n        c.insets = new Insets(y == 0 ? 10 : 0, x == 0 ? 10 : GAP, GAP, GAP);\r\n        p.add(co, c);\r\n    }\r\n\r\n    protected String getSuiteText() {\r\n        if (fSuiteCombo == null)\r\n            return \"\";\r\n        return (String) fSuiteCombo.getEditor().getItem();\r\n    }\r\n\r\n    public ListModel getFailures() {\r\n        return fFailures;\r\n    }\r\n\r\n    public void insertUpdate(DocumentEvent event) {\r\n        textChanged();\r\n    }\r\n\r\n    public void browseTestClasses() {\r\n        TestCollector collector = createTestCollector();\r\n        TestSelector selector = new TestSelector(fFrame, collector);\r\n        if (selector.isEmpty()) {\r\n            JOptionPane.showMessageDialog(fFrame, \"No Test Cases found.\\nCheck that the configured \\'TestCollector\\' is supported on this platform.\");\r\n            return;\r\n        }\r\n        selector.show();\r\n        String className = selector.getSelectedItem();\r\n        if (className != null)\r\n            setSuite(className);\r\n    }\r\n\r\n    TestCollector createTestCollector() {\r\n        String className = BaseTestRunner.getPreference(TESTCOLLECTOR_KEY);\r\n        if (className != null) {\r\n            Class collectorClass = null;\r\n            try {\r\n                collectorClass = Class.forName(className);\r\n                return (TestCollector) collectorClass.newInstance();\r\n            } catch (Exception e) {\r\n                JOptionPane.showMessageDialog(fFrame, \"Could not create TestCollector - using default collector\");\r\n            }\r\n        }\r\n        return new SimpleTestCollector();\r\n    }\r\n\r\n    private Image loadFrameIcon() {\r\n        ImageIcon icon = (ImageIcon) getIconResource(BaseTestRunner.class, \"smalllogo.gif\");\r\n        if (icon != null)\r\n            return icon.getImage();\r\n        return null;\r\n    }\r\n\r\n    private void loadHistory(JComboBox combo) throws IOException {\r\n        BufferedReader br = new BufferedReader(new FileReader(getSettingsFile()));\r\n        int itemCount = 0;\r\n        try {\r\n            String line;\r\n            while ((line = br.readLine()) != null) {\r\n                combo.addItem(line);\r\n                itemCount++;\r\n            }\r\n            if (itemCount > 0)\r\n                combo.setSelectedIndex(0);\r\n        } finally {\r\n            br.close();\r\n        }\r\n    }\r\n\r\n    private File getSettingsFile() {\r\n        String home = System.getProperty(\"user.home\");\r\n        return new File(home, \".junitsession\");\r\n    }\r\n\r\n    private void postInfo(final String message) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                showInfo(message);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void postStatus(final String status) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                showStatus(status);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void removeUpdate(DocumentEvent event) {\r\n        textChanged();\r\n    }\r\n\r\n    private void rerun() {\r\n        TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n        Test rerunTest = view.getSelectedTest();\r\n        if (rerunTest != null)\r\n            rerunTest(rerunTest);\r\n    }\r\n\r\n    private void rerunTest(Test test) {\r\n        if (!(test instanceof TestCase)) {\r\n            showInfo(\"Could not reload \" + test.toString());\r\n            return;\r\n        }\r\n        Test reloadedTest = null;\r\n        TestCase rerunTest = (TestCase) test;\r\n        try {\r\n            Class reloadedTestClass = getLoader().reload(test.getClass());\r\n            reloadedTest = TestSuite.createTest(reloadedTestClass, rerunTest.getName());\r\n        } catch (Exception e) {\r\n            showInfo(\"Could not reload \" + test.toString());\r\n            return;\r\n        }\r\n        TestResult result = new TestResult();\r\n        reloadedTest.run(result);\r\n        String message = reloadedTest.toString();\r\n        if (result.wasSuccessful())\r\n            showInfo(message + \" was successful\");\r\n        else if (result.errorCount() == 1)\r\n            showStatus(message + \" had an error\");\r\n        else\r\n            showStatus(message + \" had a failure\");\r\n    }\r\n\r\n    protected void reset() {\r\n        fCounterPanel.reset();\r\n        fProgressIndicator.reset();\r\n        fRerunButton.setEnabled(false);\r\n        fFailureView.clear();\r\n        fFailures.clear();\r\n    }\r\n\r\n    protected void runFailed(String message) {\r\n        showStatus(message);\r\n        fRun.setText(\"Run\");\r\n        fRunner = null;\r\n    }\r\n\r\n    synchronized public void runSuite() {\r\n        if (fRunner != null) {\r\n            fTestResult.stop();\r\n        } else {\r\n            setLoading(shouldReload());\r\n            /*{*/\r\n            fCounterPanel.reset();\r\n            fProgressIndicator.reset();\r\n            fRerunButton.setEnabled(false);\r\n            fFailureView.clear();\r\n            fFailures.clear();\r\n            /*}*/\r\n            showInfo(\"Load Test Case...\");\r\n            final String suiteName = getSuiteText();\r\n            final Test testSuite = getTest(suiteName);\r\n            if (testSuite != null) {\r\n                addToHistory(suiteName);\r\n                doRunTest(testSuite);\r\n            }\r\n        }\r\n    }\r\n\r\n    private boolean shouldReload() {\r\n        return !inVAJava() && fUseLoadingRunner.isSelected();\r\n    }\r\n\r\n    synchronized protected void runTest(final Test testSuite) {\r\n        if (fRunner != null) {\r\n            fTestResult.stop();\r\n        } else {\r\n            /*{*/\r\n            fCounterPanel.reset();\r\n            fProgressIndicator.reset();\r\n            fRerunButton.setEnabled(false);\r\n            fFailureView.clear();\r\n            fFailures.clear();\r\n            /*}*/\r\n            if (testSuite != null) {\r\n                doRunTest(testSuite);\r\n            }\r\n        }\r\n    }\r\n\r\n    private void doRunTest(final Test testSuite) {\r\n        setButtonLabel(fRun, \"Stop\");\r\n        fRunner = new Thread(\"TestRunner-Thread\") {\r\n\r\n            public void run() {\r\n                TestRunner.this.start(testSuite);\r\n                postInfo(\"Running...\");\r\n                long startTime = System.currentTimeMillis();\r\n                testSuite.run(fTestResult);\r\n                if (fTestResult.shouldStop()) {\r\n                    postStatus(\"Stopped\");\r\n                } else {\r\n                    long endTime = System.currentTimeMillis();\r\n                    long runTime = endTime - startTime;\r\n                    postInfo(\"Finished: \" + elapsedTimeAsString(runTime) + \" seconds\");\r\n                }\r\n                runFinished(testSuite);\r\n                setButtonLabel(fRun, \"Run\");\r\n                fRunner = null;\r\n                System.gc();\r\n            }\r\n        };\r\n        // make sure that the test result is created before we start the\r\n        // test runner thread so that listeners can register for it.\r\n        fTestResult = createTestResult();\r\n        fTestResult.addListener(TestRunner.this);\r\n        aboutToStart(testSuite);\r\n        fRunner.start();\r\n    }\r\n\r\n    private void saveHistory() throws IOException {\r\n        BufferedWriter bw = new BufferedWriter(new FileWriter(getSettingsFile()));\r\n        try {\r\n            for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n                String testsuite = fSuiteCombo.getItemAt(i).toString();\r\n                bw.write(testsuite, 0, testsuite.length());\r\n                bw.newLine();\r\n            }\r\n        } finally {\r\n            bw.close();\r\n        }\r\n    }\r\n\r\n    private void setButtonLabel(final JButton button, final String label) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                button.setText(label);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void setLabelValue(final JTextField label, final int value) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                label.setText(Integer.toString(value));\r\n            }\r\n        });\r\n    }\r\n\r\n    public void handleTestSelected(Test test) {\r\n        fRerunButton.setEnabled(test != null && (test instanceof TestCase));\r\n        showFailureDetail(test);\r\n    }\r\n\r\n    private void showFailureDetail(Test test) {\r\n        if (test != null) {\r\n            ListModel failures = getFailures();\r\n            for (int i = 0; i < failures.getSize(); i++) {\r\n                TestFailure failure = (TestFailure) failures.getElementAt(i);\r\n                if (failure.failedTest() == test) {\r\n                    fFailureView.showFailure(failure);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        fFailureView.clear();\r\n    }\r\n\r\n    private void showInfo(String message) {\r\n        fStatusLine.showInfo(message);\r\n    }\r\n\r\n    private void showStatus(String status) {\r\n        fStatusLine.showError(status);\r\n    }\r\n\r\n    /**\r\n     * Starts the TestRunner\r\n     */\r\n    public void start(String[] args) {\r\n        String suiteName = processArguments(args);\r\n        fFrame = createUI(suiteName);\r\n        fFrame.pack();\r\n        fFrame.setVisible(true);\r\n        if (suiteName != null) {\r\n            setSuite(suiteName);\r\n            runSuite();\r\n        }\r\n    }\r\n\r\n    private void start(final Test test) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                int total = test.countTestCases();\r\n                fProgressIndicator.start(total);\r\n                fCounterPanel.setTotal(total);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Wait until all the events are processed in the event thread\r\n     */\r\n    private void synchUI() {\r\n        try {\r\n            SwingUtilities.invokeAndWait(new Runnable() {\r\n\r\n                public void run() {\r\n                }\r\n            });\r\n        } catch (Exception e) {\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Terminates the TestRunner\r\n     */\r\n    public void terminate() {\r\n        fFrame.dispose();\r\n        try {\r\n            /*{*/\r\n            BufferedWriter bw = new BufferedWriter(new FileWriter(getSettingsFile()));\r\n            try {\r\n                for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n                    String testsuite = fSuiteCombo.getItemAt(i).toString();\r\n                    bw.write(testsuite, 0, testsuite.length());\r\n                    bw.newLine();\r\n                }\r\n            } finally {\r\n                bw.close();\r\n            }\r\n            /*}*/\r\n        } catch (IOException e) {\r\n            System.out.println(\"Couldn't save test run history\");\r\n        }\r\n        System.exit(0);\r\n    }\r\n\r\n    public void textChanged() {\r\n        fRun.setEnabled(getSuiteText().length() > 0);\r\n        clearStatus();\r\n    }\r\n\r\n    protected void clearStatus() {\r\n        fStatusLine.clear();\r\n    }\r\n\r\n    public static Icon getIconResource(Class clazz, String name) {\r\n        URL url = clazz.getResource(name);\r\n        if (url == null) {\r\n            System.err.println(\"Warning: could not load \\\"\" + name + \"\\\" icon\");\r\n            return null;\r\n        }\r\n        return new ImageIcon(url);\r\n    }\r\n\r\n    private void about() {\r\n        AboutDialog about = new AboutDialog(fFrame);\r\n        about.show();\r\n    }\r\n}\r\n",
  "classDeclarationCode": "/**\r\n * A Swing based user interface to run tests.\r\n * Enter the name of a class which either provides a static\r\n * suite method or is a subclass of TestCase.\r\n * <pre>\r\n * Synopsis: java junit.swingui.TestRunner [-noloading] [TestCase]\r\n * </pre>\r\n * TestRunner takes as an optional argument the name of the testcase class to be run.\r\n */\r\npublic class TestRunner extends BaseTestRunner implements TestRunContext {\r\n\r\n    private static Font PLAIN_FONT = StatusLine.PLAIN_FONT;\r\n\r\n    private static Font BOLD_FONT = StatusLine.BOLD_FONT;\r\n\r\n    private static final int GAP = 4;\r\n\r\n    private static final int HISTORY_LENGTH = 5;\r\n\r\n    protected JFrame fFrame;\r\n\r\n    private Thread fRunner;\r\n\r\n    private TestResult fTestResult;\r\n\r\n    private JComboBox fSuiteCombo;\r\n\r\n    private ProgressBar fProgressIndicator;\r\n\r\n    private DefaultListModel fFailures;\r\n\r\n    private JLabel fLogo;\r\n\r\n    private CounterPanel fCounterPanel;\r\n\r\n    private JButton fRun;\r\n\r\n    private JButton fQuitButton;\r\n\r\n    private JButton fRerunButton;\r\n\r\n    private StatusLine fStatusLine;\r\n\r\n    private FailureDetailView fFailureView;\r\n\r\n    private JTabbedPane fTestViewTab;\r\n\r\n    private JCheckBox fUseLoadingRunner;\r\n\r\n    // view associated with tab in tabbed pane\r\n    private Vector fTestRunViews = new Vector();\r\n\r\n    private static final String TESTCOLLECTOR_KEY = \"TestCollectorClass\";\r\n\r\n    private static final String FAILUREDETAILVIEW_KEY = \"FailureViewClass\";\r\n\r\n    public TestRunner() {\r\n    }\r\n\r\n    public static void main(String[] args) {\r\n        new TestRunner().start(args);\r\n    }\r\n\r\n    public static void run(Class test) {\r\n        String[] args = { test.getName() };\r\n        main(args);\r\n    }\r\n\r\n    public void testFailed(final int status, final Test test, final Throwable t) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                switch(status) {\r\n                    case TestRunListener.STATUS_ERROR:\r\n                        fCounterPanel.setErrorValue(fTestResult.errorCount());\r\n                        /*{*/\r\n                        fFailures.addElement(new TestFailure(test, t));\r\n                        if (fFailures.size() == 1)\r\n                            revealFailure(test);\r\n                        /*}*/\r\n                        break;\r\n                    case TestRunListener.STATUS_FAILURE:\r\n                        fCounterPanel.setFailureValue(fTestResult.failureCount());\r\n                        appendFailure(\"Failure\", test, t);\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public void testStarted(String testName) {\r\n        postInfo(\"Running: \" + testName);\r\n    }\r\n\r\n    public void testEnded(String stringName) {\r\n        synchUI();\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                if (fTestResult != null) {\r\n                    fCounterPanel.setRunValue(fTestResult.runCount());\r\n                    fProgressIndicator.step(fTestResult.runCount(), fTestResult.wasSuccessful());\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public void setSuite(String suiteName) {\r\n        fSuiteCombo.getEditor().setItem(suiteName);\r\n    }\r\n\r\n    private void addToHistory(final String suite) {\r\n        for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n            if (suite.equals(fSuiteCombo.getItemAt(i))) {\r\n                fSuiteCombo.removeItemAt(i);\r\n                fSuiteCombo.insertItemAt(suite, 0);\r\n                fSuiteCombo.setSelectedIndex(0);\r\n                return;\r\n            }\r\n        }\r\n        fSuiteCombo.insertItemAt(suite, 0);\r\n        fSuiteCombo.setSelectedIndex(0);\r\n        /*{*/\r\n        int historyLength = getPreference(\"maxhistory\", HISTORY_LENGTH);\r\n        if (historyLength < 1)\r\n            historyLength = 1;\r\n        for (int i = fSuiteCombo.getItemCount() - 1; i > historyLength - 1; i--) fSuiteCombo.removeItemAt(i);\r\n        /*}*/\r\n    }\r\n\r\n    private void pruneHistory() {\r\n        int historyLength = getPreference(\"maxhistory\", HISTORY_LENGTH);\r\n        if (historyLength < 1)\r\n            historyLength = 1;\r\n        for (int i = fSuiteCombo.getItemCount() - 1; i > historyLength - 1; i--) fSuiteCombo.removeItemAt(i);\r\n    }\r\n\r\n    private void appendFailure(String kind, Test test, Throwable t) {\r\n        fFailures.addElement(new TestFailure(test, t));\r\n        if (fFailures.size() == 1)\r\n            revealFailure(test);\r\n    }\r\n\r\n    private void revealFailure(Test test) {\r\n        for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n            TestRunView v = (TestRunView) e.nextElement();\r\n            v.revealFailure(test);\r\n        }\r\n    }\r\n\r\n    protected void aboutToStart(final Test testSuite) {\r\n        for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n            TestRunView v = (TestRunView) e.nextElement();\r\n            v.aboutToStart(testSuite, fTestResult);\r\n        }\r\n    }\r\n\r\n    protected void runFinished(final Test testSuite) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                for (Enumeration e = fTestRunViews.elements(); e.hasMoreElements(); ) {\r\n                    TestRunView v = (TestRunView) e.nextElement();\r\n                    v.runFinished(testSuite, fTestResult);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected CounterPanel createCounterPanel() {\r\n        return new CounterPanel();\r\n    }\r\n\r\n    protected JPanel createFailedPanel() {\r\n        JPanel failedPanel = new JPanel(new GridLayout(0, 1, 0, 2));\r\n        fRerunButton = new JButton(\"Run\");\r\n        fRerunButton.setEnabled(false);\r\n        fRerunButton.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n                Test rerunTest = view.getSelectedTest();\r\n                if (rerunTest != null)\r\n                    rerunTest(rerunTest);\r\n                /*}*/\r\n            }\r\n        });\r\n        failedPanel.add(fRerunButton);\r\n        return failedPanel;\r\n    }\r\n\r\n    protected FailureDetailView createFailureDetailView() {\r\n        String className = BaseTestRunner.getPreference(FAILUREDETAILVIEW_KEY);\r\n        if (className != null) {\r\n            Class viewClass = null;\r\n            try {\r\n                viewClass = Class.forName(className);\r\n                return (FailureDetailView) viewClass.newInstance();\r\n            } catch (Exception e) {\r\n                JOptionPane.showMessageDialog(fFrame, \"Could not create Failure DetailView - using default view\");\r\n            }\r\n        }\r\n        return new DefaultFailureDetailView();\r\n    }\r\n\r\n    /**\r\n     * Creates the JUnit menu. Clients override this\r\n     * method to add additional menu items.\r\n     */\r\n    protected JMenu createJUnitMenu() {\r\n        JMenu menu = new JMenu(\"JUnit\");\r\n        menu.setMnemonic('J');\r\n        JMenuItem mi1 = new JMenuItem(\"About...\");\r\n        mi1.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent event) {\r\n                about();\r\n            }\r\n        });\r\n        mi1.setMnemonic('A');\r\n        menu.add(mi1);\r\n        menu.addSeparator();\r\n        JMenuItem mi2 = new JMenuItem(\" Exit \");\r\n        mi2.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent event) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        mi2.setMnemonic('x');\r\n        menu.add(mi2);\r\n        return menu;\r\n    }\r\n\r\n    protected JFrame createFrame(String title) {\r\n        JFrame frame = new JFrame(\"JUnit\");\r\n        Image icon = loadFrameIcon();\r\n        if (icon != null)\r\n            frame.setIconImage(icon);\r\n        frame.getContentPane().setLayout(new BorderLayout(0, 0));\r\n        frame.addWindowListener(new WindowAdapter() {\r\n\r\n            public void windowClosing(WindowEvent e) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e1) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        return frame;\r\n    }\r\n\r\n    protected JLabel createLogo() {\r\n        JLabel label;\r\n        Icon icon = getIconResource(BaseTestRunner.class, \"logo.gif\");\r\n        if (icon != null)\r\n            label = new JLabel(icon);\r\n        else\r\n            label = new JLabel(\"JV\");\r\n        label.setToolTipText(\"JUnit Version \" + Version.id());\r\n        return label;\r\n    }\r\n\r\n    protected void createMenus(JMenuBar mb) {\r\n        mb.add(createJUnitMenu());\r\n    }\r\n\r\n    protected JCheckBox createUseLoaderCheckBox() {\r\n        boolean useLoader = useReloadingTestSuiteLoader();\r\n        JCheckBox box = new JCheckBox(\"Reload classes every run\", useLoader);\r\n        box.setToolTipText(\"Use a custom class loader to reload the classes for every run\");\r\n        if (inVAJava())\r\n            box.setVisible(false);\r\n        return box;\r\n    }\r\n\r\n    protected JButton createQuitButton() {\r\n        // spaces required to avoid layout flicker\r\n        // Exit is shorter than Stop that shows in the same column\r\n        JButton quit = new JButton(\" Exit \");\r\n        quit.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                fFrame.dispose();\r\n                try {\r\n                    saveHistory();\r\n                } catch (IOException e1) {\r\n                    System.out.println(\"Couldn't save test run history\");\r\n                }\r\n                System.exit(0);\r\n                /*}*/\r\n            }\r\n        });\r\n        return quit;\r\n    }\r\n\r\n    protected JButton createRunButton() {\r\n        JButton run = new JButton(\"Run\");\r\n        run.setEnabled(true);\r\n        run.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                /*{*/\r\n                if (fRunner != null) {\r\n                    fTestResult.stop();\r\n                } else {\r\n                    setLoading(shouldReload());\r\n                    reset();\r\n                    showInfo(\"Load Test Case...\");\r\n                    final String suiteName = getSuiteText();\r\n                    final Test testSuite = getTest(suiteName);\r\n                    if (testSuite != null) {\r\n                        addToHistory(suiteName);\r\n                        doRunTest(testSuite);\r\n                    }\r\n                }\r\n                /*}*/\r\n            }\r\n        });\r\n        return run;\r\n    }\r\n\r\n    protected Component createBrowseButton() {\r\n        JButton browse = new JButton(\"...\");\r\n        browse.setToolTipText(\"Select a Test class\");\r\n        browse.addActionListener(new ActionListener() {\r\n\r\n            public void actionPerformed(ActionEvent e) {\r\n                browseTestClasses();\r\n            }\r\n        });\r\n        return browse;\r\n    }\r\n\r\n    protected StatusLine createStatusLine() {\r\n        return new StatusLine(380);\r\n    }\r\n\r\n    protected JComboBox createSuiteCombo() {\r\n        JComboBox combo = new JComboBox();\r\n        combo.setEditable(true);\r\n        combo.setLightWeightPopupEnabled(false);\r\n        combo.getEditor().getEditorComponent().addKeyListener(new KeyAdapter() {\r\n\r\n            public void keyTyped(KeyEvent e) {\r\n                textChanged();\r\n                if (e.getKeyChar() == KeyEvent.VK_ENTER)\r\n                    /*{*/\r\n                    if (fRunner != null) {\r\n                        fTestResult.stop();\r\n                    } else {\r\n                        setLoading(shouldReload());\r\n                        reset();\r\n                        showInfo(\"Load Test Case...\");\r\n                        final String suiteName = getSuiteText();\r\n                        final Test testSuite = getTest(suiteName);\r\n                        if (testSuite != null) {\r\n                            addToHistory(suiteName);\r\n                            doRunTest(testSuite);\r\n                        }\r\n                    }\r\n                /*}*/\r\n            }\r\n        });\r\n        try {\r\n            loadHistory(combo);\r\n        } catch (IOException e) {\r\n            // fails the first time\r\n        }\r\n        combo.addItemListener(new ItemListener() {\r\n\r\n            public void itemStateChanged(ItemEvent event) {\r\n                if (event.getStateChange() == ItemEvent.SELECTED) {\r\n                    textChanged();\r\n                }\r\n            }\r\n        });\r\n        return combo;\r\n    }\r\n\r\n    protected JTabbedPane createTestRunViews() {\r\n        JTabbedPane pane = new JTabbedPane(JTabbedPane.BOTTOM);\r\n        FailureRunView lv = new FailureRunView(this);\r\n        fTestRunViews.addElement(lv);\r\n        lv.addTab(pane);\r\n        TestHierarchyRunView tv = new TestHierarchyRunView(this);\r\n        fTestRunViews.addElement(tv);\r\n        tv.addTab(pane);\r\n        pane.addChangeListener(new ChangeListener() {\r\n\r\n            public void stateChanged(ChangeEvent e) {\r\n                testViewChanged();\r\n            }\r\n        });\r\n        return pane;\r\n    }\r\n\r\n    public void testViewChanged() {\r\n        TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n        view.activate();\r\n    }\r\n\r\n    protected TestResult createTestResult() {\r\n        return new TestResult();\r\n    }\r\n\r\n    protected JFrame createUI(String suiteName) {\r\n        JFrame frame = createFrame(\"JUnit\");\r\n        JMenuBar mb = new JMenuBar();\r\n        createMenus(mb);\r\n        frame.setJMenuBar(mb);\r\n        JLabel suiteLabel = new JLabel(\"Test class name:\");\r\n        fSuiteCombo = createSuiteCombo();\r\n        fRun = createRunButton();\r\n        frame.getRootPane().setDefaultButton(fRun);\r\n        Component browseButton = createBrowseButton();\r\n        fUseLoadingRunner = createUseLoaderCheckBox();\r\n        fProgressIndicator = new ProgressBar();\r\n        fCounterPanel = createCounterPanel();\r\n        fFailures = new DefaultListModel();\r\n        fTestViewTab = createTestRunViews();\r\n        JPanel failedPanel = createFailedPanel();\r\n        fFailureView = createFailureDetailView();\r\n        JScrollPane tracePane = new JScrollPane(fFailureView.getComponent(), JScrollPane.VERTICAL_SCROLLBAR_ALWAYS, JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);\r\n        fStatusLine = createStatusLine();\r\n        fQuitButton = createQuitButton();\r\n        fLogo = createLogo();\r\n        JPanel panel = new JPanel(new GridBagLayout());\r\n        /*{*/\r\n        int fill = GridBagConstraints.HORIZONTAL;\r\n        GridBagConstraints c = new GridBagConstraints();\r\n        c.gridx = 0;\r\n        c.gridy = 0;\r\n        c.gridwidth = 2;\r\n        c.anchor = GridBagConstraints.WEST;\r\n        c.weightx = 1.0;\r\n        c.fill = fill;\r\n        if (fill == GridBagConstraints.BOTH || fill == GridBagConstraints.VERTICAL)\r\n            c.weighty = 1.0;\r\n        c.insets = new Insets(0 == 0 ? 10 : 0, 0 == 0 ? 10 : GAP, GAP, GAP);\r\n        panel.add(suiteLabel, c);\r\n        /*}*/\r\n        addGrid(panel, fSuiteCombo, 0, 1, 1, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, browseButton, 1, 1, 1, GridBagConstraints.NONE, 0.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fRun, 2, 1, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.CENTER);\r\n        addGrid(panel, fUseLoadingRunner, 0, 2, 3, GridBagConstraints.NONE, 1.0, GridBagConstraints.WEST);\r\n        // addGrid(panel, new JSeparator(), \t0, 3, 3, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fProgressIndicator, 0, 3, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, fLogo, 2, 3, 1, GridBagConstraints.NONE, 0.0, GridBagConstraints.NORTH);\r\n        addGrid(panel, fCounterPanel, 0, 4, 2, GridBagConstraints.NONE, 0.0, GridBagConstraints.WEST);\r\n        addGrid(panel, new JSeparator(), 0, 5, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, new JLabel(\"Results:\"), 0, 6, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.WEST);\r\n        JSplitPane splitter = new JSplitPane(JSplitPane.VERTICAL_SPLIT, fTestViewTab, tracePane);\r\n        addGrid(panel, splitter, 0, 7, 2, GridBagConstraints.BOTH, 1.0, GridBagConstraints.WEST);\r\n        addGrid(panel, failedPanel, 2, 7, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.NORTH);\r\n        addGrid(panel, fStatusLine, 0, 9, 2, GridBagConstraints.HORIZONTAL, 1.0, GridBagConstraints.CENTER);\r\n        addGrid(panel, fQuitButton, 2, 9, 1, GridBagConstraints.HORIZONTAL, 0.0, GridBagConstraints.CENTER);\r\n        frame.setContentPane(panel);\r\n        frame.pack();\r\n        frame.setLocation(200, 200);\r\n        return frame;\r\n    }\r\n\r\n    private void addGrid(JPanel p, Component co, int x, int y, int w, int fill, double wx, int anchor) {\r\n        GridBagConstraints c = new GridBagConstraints();\r\n        c.gridx = x;\r\n        c.gridy = y;\r\n        c.gridwidth = w;\r\n        c.anchor = anchor;\r\n        c.weightx = wx;\r\n        c.fill = fill;\r\n        if (fill == GridBagConstraints.BOTH || fill == GridBagConstraints.VERTICAL)\r\n            c.weighty = 1.0;\r\n        c.insets = new Insets(y == 0 ? 10 : 0, x == 0 ? 10 : GAP, GAP, GAP);\r\n        p.add(co, c);\r\n    }\r\n\r\n    protected String getSuiteText() {\r\n        if (fSuiteCombo == null)\r\n            return \"\";\r\n        return (String) fSuiteCombo.getEditor().getItem();\r\n    }\r\n\r\n    public ListModel getFailures() {\r\n        return fFailures;\r\n    }\r\n\r\n    public void insertUpdate(DocumentEvent event) {\r\n        textChanged();\r\n    }\r\n\r\n    public void browseTestClasses() {\r\n        TestCollector collector = createTestCollector();\r\n        TestSelector selector = new TestSelector(fFrame, collector);\r\n        if (selector.isEmpty()) {\r\n            JOptionPane.showMessageDialog(fFrame, \"No Test Cases found.\\nCheck that the configured \\'TestCollector\\' is supported on this platform.\");\r\n            return;\r\n        }\r\n        selector.show();\r\n        String className = selector.getSelectedItem();\r\n        if (className != null)\r\n            setSuite(className);\r\n    }\r\n\r\n    TestCollector createTestCollector() {\r\n        String className = BaseTestRunner.getPreference(TESTCOLLECTOR_KEY);\r\n        if (className != null) {\r\n            Class collectorClass = null;\r\n            try {\r\n                collectorClass = Class.forName(className);\r\n                return (TestCollector) collectorClass.newInstance();\r\n            } catch (Exception e) {\r\n                JOptionPane.showMessageDialog(fFrame, \"Could not create TestCollector - using default collector\");\r\n            }\r\n        }\r\n        return new SimpleTestCollector();\r\n    }\r\n\r\n    private Image loadFrameIcon() {\r\n        ImageIcon icon = (ImageIcon) getIconResource(BaseTestRunner.class, \"smalllogo.gif\");\r\n        if (icon != null)\r\n            return icon.getImage();\r\n        return null;\r\n    }\r\n\r\n    private void loadHistory(JComboBox combo) throws IOException {\r\n        BufferedReader br = new BufferedReader(new FileReader(getSettingsFile()));\r\n        int itemCount = 0;\r\n        try {\r\n            String line;\r\n            while ((line = br.readLine()) != null) {\r\n                combo.addItem(line);\r\n                itemCount++;\r\n            }\r\n            if (itemCount > 0)\r\n                combo.setSelectedIndex(0);\r\n        } finally {\r\n            br.close();\r\n        }\r\n    }\r\n\r\n    private File getSettingsFile() {\r\n        String home = System.getProperty(\"user.home\");\r\n        return new File(home, \".junitsession\");\r\n    }\r\n\r\n    private void postInfo(final String message) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                showInfo(message);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void postStatus(final String status) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                showStatus(status);\r\n            }\r\n        });\r\n    }\r\n\r\n    public void removeUpdate(DocumentEvent event) {\r\n        textChanged();\r\n    }\r\n\r\n    private void rerun() {\r\n        TestRunView view = (TestRunView) fTestRunViews.elementAt(fTestViewTab.getSelectedIndex());\r\n        Test rerunTest = view.getSelectedTest();\r\n        if (rerunTest != null)\r\n            rerunTest(rerunTest);\r\n    }\r\n\r\n    private void rerunTest(Test test) {\r\n        if (!(test instanceof TestCase)) {\r\n            showInfo(\"Could not reload \" + test.toString());\r\n            return;\r\n        }\r\n        Test reloadedTest = null;\r\n        TestCase rerunTest = (TestCase) test;\r\n        try {\r\n            Class reloadedTestClass = getLoader().reload(test.getClass());\r\n            reloadedTest = TestSuite.createTest(reloadedTestClass, rerunTest.getName());\r\n        } catch (Exception e) {\r\n            showInfo(\"Could not reload \" + test.toString());\r\n            return;\r\n        }\r\n        TestResult result = new TestResult();\r\n        reloadedTest.run(result);\r\n        String message = reloadedTest.toString();\r\n        if (result.wasSuccessful())\r\n            showInfo(message + \" was successful\");\r\n        else if (result.errorCount() == 1)\r\n            showStatus(message + \" had an error\");\r\n        else\r\n            showStatus(message + \" had a failure\");\r\n    }\r\n\r\n    protected void reset() {\r\n        fCounterPanel.reset();\r\n        fProgressIndicator.reset();\r\n        fRerunButton.setEnabled(false);\r\n        fFailureView.clear();\r\n        fFailures.clear();\r\n    }\r\n\r\n    protected void runFailed(String message) {\r\n        showStatus(message);\r\n        fRun.setText(\"Run\");\r\n        fRunner = null;\r\n    }\r\n\r\n    synchronized public void runSuite() {\r\n        if (fRunner != null) {\r\n            fTestResult.stop();\r\n        } else {\r\n            setLoading(shouldReload());\r\n            /*{*/\r\n            fCounterPanel.reset();\r\n            fProgressIndicator.reset();\r\n            fRerunButton.setEnabled(false);\r\n            fFailureView.clear();\r\n            fFailures.clear();\r\n            /*}*/\r\n            showInfo(\"Load Test Case...\");\r\n            final String suiteName = getSuiteText();\r\n            final Test testSuite = getTest(suiteName);\r\n            if (testSuite != null) {\r\n                addToHistory(suiteName);\r\n                doRunTest(testSuite);\r\n            }\r\n        }\r\n    }\r\n\r\n    private boolean shouldReload() {\r\n        return !inVAJava() && fUseLoadingRunner.isSelected();\r\n    }\r\n\r\n    synchronized protected void runTest(final Test testSuite) {\r\n        if (fRunner != null) {\r\n            fTestResult.stop();\r\n        } else {\r\n            /*{*/\r\n            fCounterPanel.reset();\r\n            fProgressIndicator.reset();\r\n            fRerunButton.setEnabled(false);\r\n            fFailureView.clear();\r\n            fFailures.clear();\r\n            /*}*/\r\n            if (testSuite != null) {\r\n                doRunTest(testSuite);\r\n            }\r\n        }\r\n    }\r\n\r\n    private void doRunTest(final Test testSuite) {\r\n        setButtonLabel(fRun, \"Stop\");\r\n        fRunner = new Thread(\"TestRunner-Thread\") {\r\n\r\n            public void run() {\r\n                TestRunner.this.start(testSuite);\r\n                postInfo(\"Running...\");\r\n                long startTime = System.currentTimeMillis();\r\n                testSuite.run(fTestResult);\r\n                if (fTestResult.shouldStop()) {\r\n                    postStatus(\"Stopped\");\r\n                } else {\r\n                    long endTime = System.currentTimeMillis();\r\n                    long runTime = endTime - startTime;\r\n                    postInfo(\"Finished: \" + elapsedTimeAsString(runTime) + \" seconds\");\r\n                }\r\n                runFinished(testSuite);\r\n                setButtonLabel(fRun, \"Run\");\r\n                fRunner = null;\r\n                System.gc();\r\n            }\r\n        };\r\n        // make sure that the test result is created before we start the\r\n        // test runner thread so that listeners can register for it.\r\n        fTestResult = createTestResult();\r\n        fTestResult.addListener(TestRunner.this);\r\n        aboutToStart(testSuite);\r\n        fRunner.start();\r\n    }\r\n\r\n    private void saveHistory() throws IOException {\r\n        BufferedWriter bw = new BufferedWriter(new FileWriter(getSettingsFile()));\r\n        try {\r\n            for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n                String testsuite = fSuiteCombo.getItemAt(i).toString();\r\n                bw.write(testsuite, 0, testsuite.length());\r\n                bw.newLine();\r\n            }\r\n        } finally {\r\n            bw.close();\r\n        }\r\n    }\r\n\r\n    private void setButtonLabel(final JButton button, final String label) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                button.setText(label);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void setLabelValue(final JTextField label, final int value) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                label.setText(Integer.toString(value));\r\n            }\r\n        });\r\n    }\r\n\r\n    public void handleTestSelected(Test test) {\r\n        fRerunButton.setEnabled(test != null && (test instanceof TestCase));\r\n        showFailureDetail(test);\r\n    }\r\n\r\n    private void showFailureDetail(Test test) {\r\n        if (test != null) {\r\n            ListModel failures = getFailures();\r\n            for (int i = 0; i < failures.getSize(); i++) {\r\n                TestFailure failure = (TestFailure) failures.getElementAt(i);\r\n                if (failure.failedTest() == test) {\r\n                    fFailureView.showFailure(failure);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n        fFailureView.clear();\r\n    }\r\n\r\n    private void showInfo(String message) {\r\n        fStatusLine.showInfo(message);\r\n    }\r\n\r\n    private void showStatus(String status) {\r\n        fStatusLine.showError(status);\r\n    }\r\n\r\n    /**\r\n     * Starts the TestRunner\r\n     */\r\n    public void start(String[] args) {\r\n        String suiteName = processArguments(args);\r\n        fFrame = createUI(suiteName);\r\n        fFrame.pack();\r\n        fFrame.setVisible(true);\r\n        if (suiteName != null) {\r\n            setSuite(suiteName);\r\n            runSuite();\r\n        }\r\n    }\r\n\r\n    private void start(final Test test) {\r\n        SwingUtilities.invokeLater(new Runnable() {\r\n\r\n            public void run() {\r\n                int total = test.countTestCases();\r\n                fProgressIndicator.start(total);\r\n                fCounterPanel.setTotal(total);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Wait until all the events are processed in the event thread\r\n     */\r\n    private void synchUI() {\r\n        try {\r\n            SwingUtilities.invokeAndWait(new Runnable() {\r\n\r\n                public void run() {\r\n                }\r\n            });\r\n        } catch (Exception e) {\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Terminates the TestRunner\r\n     */\r\n    public void terminate() {\r\n        fFrame.dispose();\r\n        try {\r\n            /*{*/\r\n            BufferedWriter bw = new BufferedWriter(new FileWriter(getSettingsFile()));\r\n            try {\r\n                for (int i = 0; i < fSuiteCombo.getItemCount(); i++) {\r\n                    String testsuite = fSuiteCombo.getItemAt(i).toString();\r\n                    bw.write(testsuite, 0, testsuite.length());\r\n                    bw.newLine();\r\n                }\r\n            } finally {\r\n                bw.close();\r\n            }\r\n            /*}*/\r\n        } catch (IOException e) {\r\n            System.out.println(\"Couldn't save test run history\");\r\n        }\r\n        System.exit(0);\r\n    }\r\n\r\n    public void textChanged() {\r\n        fRun.setEnabled(getSuiteText().length() > 0);\r\n        clearStatus();\r\n    }\r\n\r\n    protected void clearStatus() {\r\n        fStatusLine.clear();\r\n    }\r\n\r\n    public static Icon getIconResource(Class clazz, String name) {\r\n        URL url = clazz.getResource(name);\r\n        if (url == null) {\r\n            System.err.println(\"Warning: could not load \\\"\" + name + \"\\\" icon\");\r\n            return null;\r\n        }\r\n        return new ImageIcon(url);\r\n    }\r\n\r\n    private void about() {\r\n        AboutDialog about = new AboutDialog(fFrame);\r\n        about.show();\r\n    }\r\n}",
  "subClasses": []
}