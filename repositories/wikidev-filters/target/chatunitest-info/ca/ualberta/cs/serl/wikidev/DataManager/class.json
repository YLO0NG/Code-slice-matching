{
  "fullClassName": "ca.ualberta.cs.serl.wikidev.DataManager",
  "className": "DataManager",
  "index": 33,
  "modifier": "[public ]",
  "extend": "[]",
  "implement": "[]",
  "packageName": "ca.ualberta.cs.serl.wikidev",
  "packageDeclaration": "package ca.ualberta.cs.serl.wikidev;",
  "classSignature": "public class DataManager",
  "hasConstructor": true,
  "isPublic": true,
  "isInterface": false,
  "isAbstract": false,
  "imports": [
    "import java.sql.Connection;",
    "import java.sql.DriverManager;",
    "import java.sql.ResultSet;",
    "import java.sql.SQLException;",
    "import java.sql.Statement;",
    "import java.sql.Timestamp;",
    "import java.util.ArrayList;",
    "import java.util.HashMap;",
    "import java.util.HashSet;",
    "import java.util.Set;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.ChangeSet;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.ChangeSetDetail;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.IArtifact;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Message;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.SourceClass;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Ticket;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.TicketChange;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Wiki;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.WikiRevision;",
    "import ca.ualberta.cs.serl.wikidev.city3d.CityLayout;",
    "import ca.ualberta.cs.serl.wikidev.city3d.IndustrialLayout;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.BuildingData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.ClusterData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.CommunicationBuildingData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.FileBuildingData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.UserData;",
    "import ca.ualberta.cs.serl.wikidev.clustering.Cluster;",
    "import ca.ualberta.cs.serl.wikidev.clustering.ClusterPoint;"
  ],
  "fields": [
    "private static final String databaseDriver = \"com.mysql.jdbc.Driver\";",
    "private static final String databaseName = \"jdbc:mysql://hypatia.cs.ualberta.ca/wikidev_ucosp\";",
    "private static final String[] entityTypes = {\"wikidev_changesets\", \"wikidev_tickets\", \"mw_page\", \"wikidev_messages\"};",
    "public static final long WEEK_INTERVAL_IN_MILLIS = 604800000;",
    "private static Connection conn;",
    "private static Statement statement;",
    "public static Set<Integer> userIDs;",
    "public static Set<User> users;",
    "public static Set<String> usernames;",
    "public static Set<Integer> projectIDs;",
    "public static Set<Project> projects;",
    "public static Set<String> artifactURLs;",
    "public static Set<IArtifact> allArtifacts;",
    "public static Set<String> classNames;",
    "public static Set<SourceClass> classes;",
    "public static HashMap<Integer, Integer> ticketids;",
    "public static Set<Ticket> tickets;",
    "public static Set<Integer> systems;",
    "public static Set<ChangeSet> changesets;",
    "public static Set<Integer> commBuildingIDs;",
    "public static Set<CommunicationBuildingData> commBuildings;",
    "public static Set<Integer> fileBuildingIDs;",
    "public static Set<FileBuildingData> fileBuildings;"
  ],
  "superClasses": [],
  "implementedTypes": [],
  "methodSigs": {
    "openTheConnection()": "0",
    "openTheConnection(String, String, String)": "1",
    "closeTheConnection()": "2",
    "getTheEarlierstTimeOfActivity()": "3",
    "getTheLatestTimeOfActivity()": "4",
    "writeCluster(Cluster)": "5",
    "writeClusterPerProject(int, int, int, String, String, String, double)": "6",
    "writeUserInCluster(Cluster)": "7",
    "getClusterID(Cluster)": "8",
    "getClusterByID(int)": "9",
    "writeCommunicationsBuildingData(CommunicationBuildingData)": "10",
    "writeFilesBuildingData(FileBuildingData)": "11",
    "getClusterIDsByBuilding(CommunicationBuildingData)": "12",
    "getArtifactsInCluster(Cluster)": "13",
    "getArtifactByTypeAndID(IArtifact, int)": "14",
    "getClusteredBuildings(CommunicationBuildingData)": "15",
    "getCommunicationsBuildingID(CommunicationBuildingData)": "16",
    "getFilesBuildingID(FileBuildingData)": "17",
    "writeCommunicationsUserData(CommunicationBuildingData)": "18",
    "writeFilesUserData(FileBuildingData)": "19",
    "writeArtifactInCluster(Cluster)": "20",
    "getCommmunicationCitySnapshot(Timestamp, int)": "21",
    "getFileCitySnapshot(Timestamp, int)": "22",
    "getUsersForBuilding(int, String)": "23",
    "getCommunicationsBuildingHistory(String, int, int)": "24",
    "getFilesBuildingHistory(String)": "25",
    "getCommunicationsCitySize(int)": "26",
    "getFilesCitySize(int)": "27",
    "getProjectByName(String)": "28",
    "getProjectByID(int)": "29",
    "getProjectByExternalSystem(int)": "30",
    "getExternalSystemByProjectID(int)": "31",
    "getUserByID(int)": "32",
    "getTicketByDrID(int, int)": "33",
    "getUsersPerProject(int)": "34",
    "getUserByUserName(String)": "35",
    "getArtifactsAfterTimestamp(String)": "36",
    "getProjectNamespaceByNamespaceID(int)": "37",
    "getProjectNamespaceByID(int)": "38",
    "getProjectNamespaceIDByProjectID(int)": "39",
    "getRevisionsByWikiID(int)": "40",
    "getRevisionTextByRevisionID(int)": "41",
    "getAllChangesetsForProject(int)": "42",
    "removeChar(String, char)": "43",
    "getArtifactsBetweenDates(String, String, int)": "44",
    "getArtifactsForProject(int)": "45",
    "getTicketChangesByTicketID(int)": "46",
    "getChangeSetDetailsByRevAndProject(int, int)": "47",
    "getProjectUsers(int)": "48",
    "DataManager()": "49"
  },
  "methodsBrief": [
    "public static void openTheConnection() throws Exceptio{}",
    "public static void openTheConnection(String username, String password, String databaseName) throws Exceptio{}",
    "public static void closeTheConnection() throws SQLException{}",
    "public static Timestamp getTheEarlierstTimeOfActivity() throws SQLException{}",
    "public static Timestamp getTheLatestTimeOfActivity() throws SQLException{}",
    "public static void writeCluster(Cluster cluster) throws SQLException{}",
    "public static void writeClusterPerProject(int projectid, int clustered, int total, String fromdate, String todate, String cluster_set_name, double threshold) throws SQLExceptio{}",
    "public static void writeUserInCluster(Cluster cluster) throws SQLException{}",
    "public static int getClusterID(Cluster cluster) throws SQLException{}",
    "private static Cluster getClusterByID(int clusterid) throws SQLException{}",
    "public static void writeCommunicationsBuildingData(CommunicationBuildingData building) throws SQLException{}",
    "public static void writeFilesBuildingData(FileBuildingData building) throws SQLException{}",
    "private static ArrayList<Integer> getClusterIDsByBuilding(CommunicationBuildingData building) throws SQLException{}",
    "private static HashMap<IArtifact, Double> getArtifactsInCluster(Cluster cluster) throws SQLException{}",
    "private static IArtifact getArtifactByTypeAndID(IArtifact anArtifact, int projectid) throws SQLExceptio{}",
    "public static ClusterData getClusteredBuildings(CommunicationBuildingData building) throws SQLException{}",
    "public static int getCommunicationsBuildingID(CommunicationBuildingData building) throws SQLException{}",
    "public static int getFilesBuildingID(FileBuildingData building) throws SQLException{}",
    "public static void writeCommunicationsUserData(CommunicationBuildingData building) throws SQLException{}",
    "public static void writeFilesUserData(FileBuildingData building) throws SQLException{}",
    "public static void writeArtifactInCluster(Cluster cluster) throws SQLException{}",
    "public static ArrayList<CommunicationBuildingData> getCommmunicationCitySnapshot(Timestamp timestamp, int projectid) throws SQLExceptio{}",
    "public static ArrayList<FileBuildingData> getFileCitySnapshot(Timestamp timestamp, int projectid) throws SQLExceptio{}",
    "private static ArrayList<UserData> getUsersForBuilding(int id, String cityType) throws SQLExceptio{}",
    "public static ArrayList<CommunicationBuildingData> getCommunicationsBuildingHistory(String type, int artifact_id, int projectid) throws SQLExceptio{}",
    "public static ArrayList<FileBuildingData> getFilesBuildingHistory(String url) throws SQLExceptio{}",
    "public static int getCommunicationsCitySize(int projectid) throws SQLException{}",
    "public static int getFilesCitySize(int projectid) throws SQLException{}",
    "public static Project getProjectByName(String projectName) throws SQLException{}",
    "public static Project getProjectByID(int projectID) throws SQLException{}",
    "public static Project getProjectByExternalSystem(int system) throws SQLException{}",
    "public static int getExternalSystemByProjectID(int projectid) throws SQLException{}",
    "public static User getUserByID(int userID) throws SQLException{}",
    "public static Ticket getTicketByDrID(int project, int ticketid) throws SQLException{}",
    "public static ArrayList<User> getUsersPerProject(int projectid) throws SQLException{}",
    "public static User getUserByUserName(String userName) throws SQLException{}",
    "public static ArrayList<IArtifact> getArtifactsAfterTimestamp(String timestamp) throws SQLException{}",
    "private static String getProjectNamespaceByNamespaceID(int page_namespace_id) throws SQLException{}",
    "private static String getProjectNamespaceByID(int projectid) throws SQLException{}",
    "private static int getProjectNamespaceIDByProjectID(int projectid) throws SQLException{}",
    "private static ArrayList<WikiRevision> getRevisionsByWikiID(int page_id) throws SQLException{}",
    "private static String getRevisionTextByRevisionID(int rev_id) throws SQLException{}",
    "public static ArrayList<ChangeSet> getAllChangesetsForProject(int system) throws SQLException{}",
    "private static String removeChar(String s, char c){}",
    "public static ArrayList<IArtifact> getArtifactsBetweenDates(String timestamp1, String timestamp2, int projectid) throws SQLException{}",
    "public static ArrayList<IArtifact> getArtifactsForProject(int projectid) throws SQLException{}",
    "public static ArrayList<TicketChange> getTicketChangesByTicketID(int ticketID) throws SQLException{}",
    "public static ArrayList<ChangeSetDetail> getChangeSetDetailsByRevAndProject(int rev, int externalsystem_id) throws SQLException{}",
    "private static Set<User> getProjectUsers(int projectID) throws SQLException{}",
    "public DataManager() throws Exception{}"
  ],
  "constructorSigs": [
    "DataManager()"
  ],
  "constructorBrief": [
    "public DataManager() throws Exception{}"
  ],
  "getterSetterSigs": [
    "getTheEarlierstTimeOfActivity()",
    "getTheLatestTimeOfActivity()"
  ],
  "getterSetterBrief": [
    "public static Timestamp getTheEarlierstTimeOfActivity() throws SQLException{}",
    "public static Timestamp getTheLatestTimeOfActivity() throws SQLException{}"
  ],
  "constructorDeps": {
    "java.lang.Class": [
      "newInstance()",
      "forName(String)"
    ],
    "java.sql.DriverManager": [
      "getConnection(String, String, String)"
    ],
    "java.sql.Connection": [
      "createStatement()"
    ]
  },
  "compilationUnitCode": "package ca.ualberta.cs.serl.wikidev;\n\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.HashSet;\nimport java.util.Set;\nimport ca.ualberta.cs.serl.wikidev.artifacts.ChangeSet;\nimport ca.ualberta.cs.serl.wikidev.artifacts.ChangeSetDetail;\nimport ca.ualberta.cs.serl.wikidev.artifacts.IArtifact;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Message;\nimport ca.ualberta.cs.serl.wikidev.artifacts.SourceClass;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Ticket;\nimport ca.ualberta.cs.serl.wikidev.artifacts.TicketChange;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Wiki;\nimport ca.ualberta.cs.serl.wikidev.artifacts.WikiRevision;\nimport ca.ualberta.cs.serl.wikidev.city3d.CityLayout;\nimport ca.ualberta.cs.serl.wikidev.city3d.IndustrialLayout;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.BuildingData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.ClusterData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.CommunicationBuildingData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.FileBuildingData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.UserData;\nimport ca.ualberta.cs.serl.wikidev.clustering.Cluster;\nimport ca.ualberta.cs.serl.wikidev.clustering.ClusterPoint;\n\npublic class DataManager {\n\n    private static final String databaseDriver = \"com.mysql.jdbc.Driver\";\n\n    private static final String databaseName = \"jdbc:mysql://hypatia.cs.ualberta.ca/wikidev_ucosp\";\n\n    // private static final String databaseName = \"jdbc:mysql://hypatia.cs.ualberta.ca/c301f09_wikidev\";\n    private static final String[] entityTypes = { \"wikidev_changesets\", \"wikidev_tickets\", \"mw_page\", \"wikidev_messages\" };\n\n    public static final long WEEK_INTERVAL_IN_MILLIS = 604800000;\n\n    private static Connection conn;\n\n    private static Statement statement;\n\n    public static Set<Integer> userIDs;\n\n    public static Set<User> users;\n\n    public static Set<String> usernames;\n\n    public static Set<Integer> projectIDs;\n\n    public static Set<Project> projects;\n\n    public static Set<String> artifactURLs;\n\n    public static Set<IArtifact> allArtifacts;\n\n    public static Set<String> classNames;\n\n    public static Set<SourceClass> classes;\n\n    public static HashMap<Integer, Integer> ticketids;\n\n    public static Set<Ticket> tickets;\n\n    public static Set<Integer> systems;\n\n    public static Set<ChangeSet> changesets;\n\n    public static Set<Integer> commBuildingIDs;\n\n    public static Set<CommunicationBuildingData> commBuildings;\n\n    public static Set<Integer> fileBuildingIDs;\n\n    public static Set<FileBuildingData> fileBuildings;\n\n    public DataManager() throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        conn = DriverManager.getConnection(databaseName, \"wikidev\", \"wikidev989\");\n        statement = conn.createStatement();\n    }\n\n    public static void openTheConnection() throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        conn = DriverManager.getConnection(databaseName, \"wikidev_ucosp\", \"XvWRSVaEVLeSH2fW \");\n        // conn=DriverManager.getConnection(databaseName, \"fokaefs\", \"filimon9786#7@gr\");\n        statement = conn.createStatement();\n        userIDs = new HashSet<Integer>();\n        users = new HashSet<User>();\n        projectIDs = new HashSet<Integer>();\n        projects = new HashSet<Project>();\n        artifactURLs = new HashSet<String>();\n        allArtifacts = new HashSet<IArtifact>();\n        classNames = new HashSet<String>();\n        classes = new HashSet<SourceClass>();\n        ticketids = new HashMap<Integer, Integer>();\n        tickets = new HashSet<Ticket>();\n        usernames = new HashSet<String>();\n        systems = new HashSet<Integer>();\n        changesets = new HashSet<ChangeSet>();\n        commBuildingIDs = new HashSet<Integer>();\n        commBuildings = new HashSet<CommunicationBuildingData>();\n        fileBuildingIDs = new HashSet<Integer>();\n        fileBuildings = new HashSet<FileBuildingData>();\n    }\n\n    public static void openTheConnection(String username, String password, String databaseName) throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        try {\n            conn = DriverManager.getConnection(databaseName, username, password);\n        } catch (SQLException e) {\n            System.out.println(e.getMessage());\n            System.exit(1);\n        }\n        statement = conn.createStatement();\n        userIDs = new HashSet<Integer>();\n        users = new HashSet<User>();\n        projectIDs = new HashSet<Integer>();\n        projects = new HashSet<Project>();\n        artifactURLs = new HashSet<String>();\n        allArtifacts = new HashSet<IArtifact>();\n        classNames = new HashSet<String>();\n        classes = new HashSet<SourceClass>();\n        ticketids = new HashMap<Integer, Integer>();\n        tickets = new HashSet<Ticket>();\n        usernames = new HashSet<String>();\n        systems = new HashSet<Integer>();\n        changesets = new HashSet<ChangeSet>();\n        commBuildingIDs = new HashSet<Integer>();\n        commBuildings = new HashSet<CommunicationBuildingData>();\n        fileBuildingIDs = new HashSet<Integer>();\n        fileBuildings = new HashSet<FileBuildingData>();\n    }\n\n    public static void closeTheConnection() throws SQLException {\n        if (statement != null)\n            statement.close();\n        if (conn != null)\n            conn.close();\n    }\n\n    public static Timestamp getTheEarlierstTimeOfActivity() throws SQLException {\n        String sqlStmt = QueryBuilder.selectTheEarliestTimeOfActivity();\n        ResultSet res = null;\n        Timestamp timestamp = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            timestamp = res.getTimestamp(\"time\");\n        }\n        if (res != null)\n            res.close();\n        return timestamp;\n    }\n\n    public static Timestamp getTheLatestTimeOfActivity() throws SQLException {\n        String sqlStmt = QueryBuilder.selectTheLatestTimeOfActivity();\n        ResultSet res = null;\n        Timestamp timestamp = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            timestamp = res.getTimestamp(\"time\");\n        }\n        if (res != null)\n            res.close();\n        return timestamp;\n    }\n\n    public static void writeCluster(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        String sqlStmt = QueryBuilder.insertIntoClusters(cluster, project.getProjectName());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeArtifactInCluster(cluster);\n        DataManager.writeUserInCluster(cluster);\n    }\n\n    public static void writeClusterPerProject(int projectid, int clustered, int total, String fromdate, String todate, String cluster_set_name, double threshold) throws SQLException {\n        Project project = DataManager.getProjectByID(projectid);\n        String sqlStmt = QueryBuilder.insertClusterPerProject(clustered, project.getProjectName(), fromdate, todate, total, cluster_set_name, threshold);\n        statement.executeUpdate(sqlStmt);\n    }\n\n    public static void writeUserInCluster(Cluster cluster) throws SQLException {\n        int clusterid = DataManager.getClusterID(cluster);\n        for (User user : cluster.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserInCluster(user.getUserName(), clusterid);\n            // System.out.println(sqlStmt);\n            statement.executeUpdate(sqlStmt);\n        }\n    }\n\n    public static int getClusterID(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        String sqlStmt = QueryBuilder.selectClusterID(cluster, project.getProjectName());\n        ResultSet res = null;\n        int clusterid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            clusterid = res.getInt(\"clusterid\");\n        }\n        if (res != null)\n            res.close();\n        return clusterid;\n    }\n\n    private static Cluster getClusterByID(int clusterid) throws SQLException {\n        String sqlStmt = QueryBuilder.selectClusterByID(clusterid);\n        ResultSet res = null;\n        Cluster cluster = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            cluster = new Cluster(res.getTimestamp(\"to_date\"), res.getString(\"project_name\"), res.getDouble(\"threshold\"), res.getString(\"terms\"), res.getInt(\"clusterid\"));\n        }\n        if (res != null)\n            res.close();\n        cluster.setProject(DataManager.getProjectByName(cluster.getProjectname()).getProjectID());\n        return cluster;\n    }\n\n    public static void writeCommunicationsBuildingData(CommunicationBuildingData building) throws SQLException {\n        String lastEditor = \"\";\n        if (building.getLastEditor() != null) {\n            lastEditor += building.getLastEditor().getUserName();\n        }\n        String sqlStmt = QueryBuilder.insertCommunicationsBuildingData(building.getType(), building.getArtifact_id(), building.getWeek().toString(), building.getHeight(), building.getNeighborhoodX(), building.getNeighborhoodY(), building.getCityBlock(), building.getUrl(), building.getProjectid(), lastEditor, building.getCreated(), building.getLastModified());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeCommunicationsUserData(building);\n    }\n\n    public static void writeFilesBuildingData(FileBuildingData building) throws SQLException {\n        String lastEditor = \"\";\n        if (building.getLastEditor() != null) {\n            lastEditor += building.getLastEditor().getUserName();\n        }\n        String sqlStmt = QueryBuilder.insertFilesBuildingData(building.getType(), building.getWeek().toString(), building.getHeight(), building.getNeighborhoodX(), building.getNeighborhoodY(), building.getCityBlock(), building.getUrl(), building.getProjectid(), lastEditor, building.getCreated(), building.getLastModified());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeFilesUserData(building);\n    }\n\n    private static ArrayList<Integer> getClusterIDsByBuilding(CommunicationBuildingData building) throws SQLException {\n        ArrayList<Integer> clusterIDs = new ArrayList<Integer>();\n        String sqlStmt = QueryBuilder.selectClusterIDsByBuilding(building);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            clusterIDs.add(res.getInt(\"clusterid\"));\n        }\n        if (res != null)\n            res.close();\n        return clusterIDs;\n    }\n\n    private static HashMap<IArtifact, Double> getArtifactsInCluster(Cluster cluster) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        HashMap<IArtifact, Double> finalArtifacts = new HashMap<IArtifact, Double>();\n        String sqlStmt = QueryBuilder.selectArtifactsInCluster(cluster);\n        IArtifact artifact = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            artifact = new IArtifact(res.getString(\"type\"), res.getInt(\"id\"));\n            artifacts.add(artifact);\n        }\n        if (res != null)\n            res.close();\n        for (IArtifact anArtifact : artifacts) {\n            finalArtifacts.put(DataManager.getArtifactByTypeAndID(anArtifact, cluster.getProject()), cluster.getThreshold());\n        }\n        return finalArtifacts;\n    }\n\n    private static IArtifact getArtifactByTypeAndID(IArtifact anArtifact, int projectid) throws SQLException {\n        Project project = DataManager.getProjectByID(projectid);\n        String sqlStmt = QueryBuilder.selectArtifactByTypeAndID(anArtifact.getType(), anArtifact.getId(), projectid);\n        ResultSet res = null;\n        IArtifact artifact = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            if (anArtifact.getType().equals(\"ChangeSet\")) {\n                artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project_id\"));\n            } else if (anArtifact.getType().equals(\"Ticket\")) {\n                artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n            } else if (anArtifact.getType().equals(\"Wiki\")) {\n                artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n            } else if (anArtifact.getType().equals(\"Message\")) {\n                artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                ;\n            }\n        }\n        if (res != null)\n            res.close();\n        if (artifact instanceof ChangeSet) {\n            ChangeSet changeSet = (ChangeSet) artifact;\n            changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n            changeSet.setProject(project);\n            changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n            for (ChangeSetDetail detail : changeSet.getChangesetDetails()) {\n                detail.setTimestamp(changeSet.getTimestamp());\n            }\n            changeSet.setAuthorForChangeSetDetails();\n            changeSet.setType(\"ChangeSet\");\n            project.addChangeset(changeSet);\n        } else if (artifact instanceof Ticket) {\n            Ticket ticket = (Ticket) artifact;\n            ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n            ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n            ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n            ticket.setProject(project);\n            ticket.setType(\"Ticket\");\n            project.addTicket(ticket);\n        } else if (artifact instanceof Message) {\n            Message communication = (Message) artifact;\n            User user = getUserByUserName(communication.getUser_name());\n            communication.setOwner(user);\n            user.setUserRealName(communication.getAuthor());\n            communication.setProject(project);\n            communication.setType(\"Message\");\n            project.addMessage(communication);\n        } else if (artifact instanceof Wiki) {\n            Wiki wiki = (Wiki) artifact;\n            wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n            wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n            wiki.setProjectID(wiki.getProject().getProjectID());\n            wiki.setType(\"Wiki\");\n        }\n        return artifact;\n    }\n\n    public static ClusterData getClusteredBuildings(CommunicationBuildingData building) throws SQLException {\n        ClusterData clusterData = new ClusterData(building.getWeek());\n        ArrayList<Integer> clusterIDs = DataManager.getClusterIDsByBuilding(building);\n        ArrayList<Cluster> clusters = new ArrayList<Cluster>();\n        for (Integer id : clusterIDs) {\n            clusters.add(DataManager.getClusterByID(id));\n        }\n        for (Cluster cluster : clusters) {\n            HashMap<IArtifact, Double> artifacts = DataManager.getArtifactsInCluster(cluster);\n            clusterData.addArtifacts(artifacts);\n            HashMap<String, Double> terms = new HashMap<String, Double>();\n            for (String term : cluster.getWords()) {\n                terms.put(term, cluster.getThreshold());\n            }\n            clusterData.addTerms(terms);\n        }\n        clusterData.calculateBuildingData();\n        return clusterData;\n    }\n\n    public static int getCommunicationsBuildingID(CommunicationBuildingData building) throws SQLException {\n        String sqlStmt = QueryBuilder.selectCommunicationsBuildingID(building, building.getProjectid());\n        ResultSet res = null;\n        int buildingid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            buildingid = res.getInt(\"building_id\");\n        }\n        if (res != null)\n            res.close();\n        return buildingid;\n    }\n\n    public static int getFilesBuildingID(FileBuildingData building) throws SQLException {\n        String sqlStmt = QueryBuilder.selectFilesBuildingID(building, building.getProjectid());\n        ResultSet res = null;\n        int buildingid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            buildingid = res.getInt(\"building_id\");\n        }\n        if (res != null)\n            res.close();\n        return buildingid;\n    }\n\n    public static void writeCommunicationsUserData(CommunicationBuildingData building) throws SQLException {\n        int buildingid = DataManager.getCommunicationsBuildingID(building);\n        for (UserData user : building.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserData(buildingid, user.getUsername(), user.getR(), user.getG(), user.getB(), user.getContribution(), user.getWeek().toString(), user.getCityType());\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static void writeFilesUserData(FileBuildingData building) throws SQLException {\n        int buildingid = DataManager.getFilesBuildingID(building);\n        for (UserData user : building.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserData(buildingid, user.getUsername(), user.getR(), user.getG(), user.getB(), user.getContribution(), user.getWeek().toString(), user.getCityType());\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static void writeArtifactInCluster(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        int clusterid = DataManager.getClusterID(cluster);\n        for (IArtifact artifact : cluster.getArtifacts()) {\n            String type = \"\";\n            int id = 0;\n            ClusterPoint point = cluster.getCoordinates().get(artifact);\n            if (artifact instanceof ChangeSet) {\n                type = \"ChangeSet\";\n                ChangeSet changeset = (ChangeSet) artifact;\n                id = changeset.getRevision();\n            } else if (artifact instanceof Ticket) {\n                type = \"Ticket\";\n                Ticket ticket = (Ticket) artifact;\n                id = ticket.getTicketID();\n            } else if (artifact instanceof Message) {\n                type = \"Message\";\n                Message message = (Message) artifact;\n                id = message.getCommunicationID();\n            } else if (artifact instanceof Wiki) {\n                type = \"Wiki\";\n                Wiki wiki = (Wiki) artifact;\n                id = wiki.getPage_id();\n            }\n            String sqlStmt = QueryBuilder.insertArtifactInCluster(type, clusterid, project.getProjectName(), id, point);\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static ArrayList<CommunicationBuildingData> getCommmunicationCitySnapshot(Timestamp timestamp, int projectid) throws SQLException {\n        ArrayList<CommunicationBuildingData> buildings = new ArrayList<CommunicationBuildingData>();\n        String sqlStmt = QueryBuilder.selectCommunicationCitySnapshot(timestamp, projectid);\n        CommunicationBuildingData building = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new CommunicationBuildingData(res.getString(\"type\"), res.getInt(\"artifact_id\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (CommunicationBuildingData data : buildings) {\n            int id = DataManager.getCommunicationsBuildingID(data);\n            data.setUsers(DataManager.getUsersForBuilding(id, CityLayout.CITY_TYPE));\n            data.setLastEditor(DataManager.getUserByUserName(data.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static ArrayList<FileBuildingData> getFileCitySnapshot(Timestamp timestamp, int projectid) throws SQLException {\n        ArrayList<FileBuildingData> buildings = new ArrayList<FileBuildingData>();\n        String sqlStmt = QueryBuilder.selectFileCitySnapshot(timestamp, projectid);\n        FileBuildingData building = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new FileBuildingData(res.getString(\"type\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (FileBuildingData data : buildings) {\n            int id = DataManager.getFilesBuildingID(data);\n            data.setUsers(DataManager.getUsersForBuilding(id, IndustrialLayout.CITY_TYPE));\n            data.setLastEditor(DataManager.getUserByUserName(data.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    private static ArrayList<UserData> getUsersForBuilding(int id, String cityType) throws SQLException {\n        ArrayList<UserData> users = new ArrayList<UserData>();\n        UserData user = null;\n        String sqlStmt = QueryBuilder.selectUsersForBuilding(id, cityType);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            user = new UserData(res.getString(\"username\"), res.getInt(\"R\"), res.getInt(\"G\"), res.getInt(\"B\"), res.getDouble(\"contribution\"), res.getTimestamp(\"week\"), res.getString(\"city_type\"));\n            users.add(user);\n        }\n        if (res != null)\n            res.close();\n        return users;\n    }\n\n    public static ArrayList<CommunicationBuildingData> getCommunicationsBuildingHistory(String type, int artifact_id, int projectid) throws SQLException {\n        ArrayList<CommunicationBuildingData> buildings = new ArrayList<CommunicationBuildingData>();\n        CommunicationBuildingData building = null;\n        String sqlStmt = QueryBuilder.selectCommunicationsBuildingHistory(type, artifact_id, projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new CommunicationBuildingData(res.getString(\"type\"), res.getInt(\"artifact_id\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (CommunicationBuildingData aBuilding : buildings) {\n            int id = getCommunicationsBuildingID(aBuilding);\n            aBuilding.setUsers(getUsersForBuilding(id, CityLayout.CITY_TYPE));\n            aBuilding.setLastEditor(DataManager.getUserByUserName(aBuilding.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static ArrayList<FileBuildingData> getFilesBuildingHistory(String url) throws SQLException {\n        ArrayList<FileBuildingData> buildings = new ArrayList<FileBuildingData>();\n        FileBuildingData building = null;\n        String sqlStmt = QueryBuilder.selectFilesBuildingHistory(url);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new FileBuildingData(res.getString(\"type\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (FileBuildingData aBuilding : buildings) {\n            int id = getFilesBuildingID(aBuilding);\n            aBuilding.setUsers(getUsersForBuilding(id, IndustrialLayout.CITY_TYPE));\n            aBuilding.setLastEditor(DataManager.getUserByUserName(aBuilding.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static int getCommunicationsCitySize(int projectid) throws SQLException {\n        int size = 3;\n        String sqlStmt = QueryBuilder.selectCommunicationsCitySize(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            size += res.getInt(\"size\");\n        }\n        if (res != null)\n            res.close();\n        return size;\n    }\n\n    public static int getFilesCitySize(int projectid) throws SQLException {\n        int size = 3;\n        String sqlStmt = QueryBuilder.selectFilesCitySize(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            size += res.getInt(\"size\");\n        }\n        if (res != null)\n            res.close();\n        return size;\n    }\n\n    public static Project getProjectByName(String projectName) throws SQLException {\n        boolean found = false;\n        Project aProject = null;\n        for (Project project : projects) {\n            if (project.getProjectName().equals(projectName)) {\n                aProject = project;\n                found = true;\n            }\n        }\n        if (!found) {\n            String sqlStmt = QueryBuilder.selectProjectByName(projectName);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                aProject = new Project(res.getInt(\"projectid\"), res.getString(\"projectname\"));\n            }\n            if (res != null)\n                res.close();\n            aProject.setUsers(getProjectUsers(aProject.getProjectID()));\n            aProject.setSystem(getExternalSystemByProjectID(aProject.getProjectID()));\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(aProject.getSystem());\n        }\n        return aProject;\n    }\n\n    public static Project getProjectByID(int projectID) throws SQLException {\n        Project aProject = null;\n        if (!projectIDs.contains(projectID)) {\n            String sqlStmt = QueryBuilder.selectProjectByID(projectID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                aProject = new Project(res.getInt(\"projectid\"), res.getString(\"projectname\"));\n            }\n            if (res != null)\n                res.close();\n            aProject.setUsers(getProjectUsers(projectID));\n            aProject.setSystem(getExternalSystemByProjectID(projectID));\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(aProject.getSystem());\n        } else {\n            for (Project project : projects) {\n                if (project.getProjectID() == projectID) {\n                    aProject = project;\n                }\n            }\n        }\n        return aProject;\n    }\n\n    public static Project getProjectByExternalSystem(int system) throws SQLException {\n        Project aProject = null;\n        int projectid = 0;\n        if (!systems.contains(system)) {\n            String sqlStmt = QueryBuilder.selectProjectIDByExternalSystem(system);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                projectid = res.getInt(\"project\");\n            }\n            if (res != null)\n                res.close();\n            aProject = getProjectByID(projectid);\n            aProject.setUsers(getProjectUsers(projectid));\n            aProject.setSystem(system);\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(system);\n        } else {\n            for (Project project : projects) {\n                if (project.getSystem() == system) {\n                    aProject = project;\n                }\n            }\n        }\n        return aProject;\n    }\n\n    public static int getExternalSystemByProjectID(int projectid) throws SQLException {\n        int system = 0;\n        String sqlStmt = QueryBuilder.selectExternalSystemByProjectID(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            system = res.getInt(\"externalsystem\");\n        }\n        if (res != null)\n            res.close();\n        return system;\n    }\n\n    public static User getUserByID(int userID) throws SQLException {\n        User user = null;\n        if (!userIDs.contains(userID)) {\n            String sqlStmt = QueryBuilder.selectUserByID(userID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                user = new User(res.getInt(\"user_id\"), res.getString(\"user_name\"), res.getString(\"user_real_name\"));\n            }\n            if (res != null)\n                res.close();\n            users.add(user);\n            userIDs.add(userID);\n            usernames.add(user.getUserName());\n        } else {\n            for (User aUser : users) {\n                if (aUser.getUserID() == userID) {\n                    user = aUser;\n                }\n            }\n        }\n        return user;\n    }\n\n    public static Ticket getTicketByDrID(int project, int ticketid) throws SQLException {\n        Ticket ticket = null;\n        if (!ticketids.containsKey(ticketid) || ticketids.get(ticketid) != null) {\n            String sqlStmt = QueryBuilder.selectTicketByDrID(ticketid, project);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                ticket = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n            }\n            if (res != null)\n                res.close();\n            ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n            ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n            ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n            ticket.setProject(getProjectByID(ticket.getProjectID()));\n            ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n            allArtifacts.add(ticket);\n        } else {\n            for (Ticket aTicket : tickets) {\n                if (aTicket.getDr_id() == ticketid && aTicket.getProjectID() == project) {\n                    ticket = aTicket;\n                }\n            }\n        }\n        return ticket;\n    }\n\n    public static ArrayList<User> getUsersPerProject(int projectid) throws SQLException {\n        ArrayList<User> users = new ArrayList<User>();\n        ArrayList<String> userNames = new ArrayList<String>();\n        String sqlStmt = QueryBuilder.selectUsersPerProject(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            userNames.add(res.getString(\"userid\"));\n        }\n        if (res != null)\n            res.close();\n        for (String username : userNames) {\n            users.add(getUserByUserName(username));\n        }\n        return users;\n    }\n\n    public static User getUserByUserName(String userName) throws SQLException {\n        User user = null;\n        userName = userName.toLowerCase();\n        if (!usernames.contains(userName)) {\n            String sqlStmt = QueryBuilder.selectUserByUserName(userName);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                user = new User(res.getInt(\"user_id\"), res.getString(\"user_name\").toLowerCase(), res.getString(\"user_real_name\"));\n            }\n            if (res != null)\n                res.close();\n            if (user != null) {\n                users.add(user);\n                userIDs.add(user.getUserID());\n                usernames.add(userName);\n            } else {\n                user = new User(userName);\n                users.add(user);\n                userIDs.add(user.getUserID());\n                usernames.add(userName);\n            }\n        } else {\n            for (User aUser : users) {\n                if (aUser.getUserName().equalsIgnoreCase(userName)) {\n                    user = aUser;\n                    break;\n                }\n            }\n        }\n        return user;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsAfterTimestamp(String timestamp) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String sqlStmt = QueryBuilder.selectArtifactsAfterTimestamp(entityType, timestamp);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"revision\"), res.getInt(\"project\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_page\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(getProjectByID(changeSet.getExternalSystemID()));\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(getProjectByID(ticket.getProjectID()));\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(getProjectByID(communication.getProject_id()));\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    private static String getProjectNamespaceByNamespaceID(int page_namespace_id) throws SQLException {\n        String namespace = \"\";\n        String sqlStmt = QueryBuilder.selectProjectNamespaceByNamespaceID(page_namespace_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            namespace = res.getString(\"nsName\");\n        }\n        if (res != null)\n            res.close();\n        return namespace;\n    }\n\n    private static String getProjectNamespaceByID(int projectid) throws SQLException {\n        String namespace = \"\";\n        String sqlStmt = QueryBuilder.selectProjectNamespaceByID(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            namespace = res.getString(\"projectname\");\n        }\n        if (res != null)\n            res.close();\n        return namespace;\n    }\n\n    private static int getProjectNamespaceIDByProjectID(int projectid) throws SQLException {\n        int id = 0;\n        String namespace = getProjectNamespaceByID(projectid);\n        String sqlStmt = QueryBuilder.selectProjectNamespaceIDbyNamespace(namespace);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            id = res.getInt(\"nsId\");\n        }\n        if (res != null)\n            res.close();\n        return id;\n    }\n\n    private static ArrayList<WikiRevision> getRevisionsByWikiID(int page_id) throws SQLException {\n        ArrayList<WikiRevision> revisions = new ArrayList<WikiRevision>();\n        String sqlStmt = QueryBuilder.selectRevisionsByWikiID(page_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            WikiRevision wikiRevision = new WikiRevision(res.getInt(\"rev_id\"), res.getInt(\"rev_page\"), res.getInt(\"rev_text_id\"), res.getString(\"rev_user_text\"), res.getTimestamp(\"rev_timestamp\"));\n            revisions.add(wikiRevision);\n        }\n        if (res != null)\n            res.close();\n        for (WikiRevision revision : revisions) {\n            revision.setRev_user(getUserByUserName(revision.getRev_user_text()));\n            revision.setRev_text(getRevisionTextByRevisionID(revision.getRev_id()));\n        }\n        return revisions;\n    }\n\n    private static String getRevisionTextByRevisionID(int rev_id) throws SQLException {\n        String text = \"\";\n        String sqlStmt = QueryBuilder.selectRevisionTextByRevisionID(rev_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            text = res.getString(1);\n        }\n        if (res != null)\n            res.close();\n        return text;\n    }\n\n    public static ArrayList<ChangeSet> getAllChangesetsForProject(int system) throws SQLException {\n        ArrayList<ChangeSet> changesets = new ArrayList<ChangeSet>();\n        Project project = getProjectByExternalSystem(system);\n        ChangeSet aChangeset = null;\n        String sqlStmt = QueryBuilder.selectAllChangesetsForProject(system);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            aChangeset = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project\"));\n            changesets.add(aChangeset);\n            DataManager.changesets.add(aChangeset);\n        }\n        if (res != null)\n            res.close();\n        for (ChangeSet changeset : changesets) {\n            changeset.setOwner(getUserByUserName(changeset.getExternalAuthorUserName()));\n            changeset.setProject(project);\n            changeset.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeset.getRevision(), changeset.getExternalSystemID()));\n            changeset.setAuthorForChangeSetDetails();\n            project.addChangeset(changeset);\n        }\n        return changesets;\n    }\n\n    private static String removeChar(String s, char c) {\n        String r = \"\";\n        for (int i = 0; i < s.length(); i++) {\n            if (s.charAt(i) != c)\n                r += s.charAt(i);\n        }\n        return r;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsBetweenDates(String timestamp1, String timestamp2, int projectid) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        Project project = getProjectByID(projectid);\n        int namespaceID = DataManager.getProjectNamespaceIDByProjectID(projectid);\n        for (ChangeSet changeset : changesets) {\n            if (changeset.getTimestamp().compareTo(Timestamp.valueOf(timestamp1)) >= 0 && changeset.getTimestamp().compareTo(Timestamp.valueOf(timestamp2)) <= 0) {\n                finalArtifacts.add(changeset);\n            }\n        }\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String nullString = \"\";\n            if (entityType.equals(\"mw_page\")) {\n                timestamp1 = removeChar(timestamp1, '-');\n                timestamp1 = removeChar(timestamp1, ' ');\n                timestamp1 = removeChar(timestamp1, ':');\n                timestamp2 = removeChar(timestamp2, '-');\n                timestamp2 = removeChar(timestamp2, ' ');\n                timestamp2 = removeChar(timestamp2, ':');\n            }\n            String sqlStmt = QueryBuilder.selectArtifactsForProjectBetweenDates(entityType, timestamp1, timestamp2, projectid, namespaceID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project_id\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_page\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(project);\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                for (ChangeSetDetail detail : changeSet.getChangesetDetails()) {\n                    detail.setTimestamp(changeSet.getTimestamp());\n                }\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n                project.addChangeset(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(project);\n                project.addTicket(ticket);\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(project);\n                project.addMessage(communication);\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setOwner(wiki.getRevisions().get(0).getRev_user());\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n                wiki.setProjectID(wiki.getProject().getProjectID());\n                finalArtifacts.add(wiki);\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsForProject(int projectid) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        Project project = getProjectByID(projectid);\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String sqlStmt = QueryBuilder.selectArtifactsForProject(entityType, projectid);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_wiki\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(project);\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n                project.addChangeset(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(project);\n                project.addTicket(ticket);\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(project);\n                project.addMessage(communication);\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n                finalArtifacts.add(wiki);\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    public static ArrayList<TicketChange> getTicketChangesByTicketID(int ticketID) throws SQLException {\n        ArrayList<TicketChange> ticketChanges = new ArrayList<TicketChange>();\n        String sqlStmt = QueryBuilder.selectTicketChangesByTicketID(ticketID);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            TicketChange ticketChange = new TicketChange(res.getString(\"author_name\"), res.getString(\"field_changed\"), res.getInt(\"id\"), res.getString(\"new_value\"), res.getString(\"old_value\"), res.getInt(\"project_ticket_id\"), res.getInt(\"ticket_id\"), res.getInt(\"project_id\"), res.getTimestamp(\"change_time\"));\n            ticketChanges.add(ticketChange);\n        }\n        if (res != null)\n            res.close();\n        for (TicketChange ticketChange : ticketChanges) {\n            ticketChange.setExternalAuthor(getUserByUserName(ticketChange.getExternalAuthorUsername()));\n        }\n        return ticketChanges;\n    }\n\n    public static ArrayList<ChangeSetDetail> getChangeSetDetailsByRevAndProject(int rev, int externalsystem_id) throws SQLException {\n        ArrayList<ChangeSetDetail> changeSetDetails = new ArrayList<ChangeSetDetail>();\n        String sqlStmt = QueryBuilder.selectChangeSetDetailByRevAndProject(rev, externalsystem_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            ChangeSetDetail changeSetDetail = new ChangeSetDetail(res.getString(\"changetype\"), res.getInt(\"externalsystem_id\"), res.getString(\"filename\"), res.getInt(\"id\"), res.getString(\"kind\"), res.getInt(\"linesadded\"), res.getInt(\"lineschanged\"), res.getInt(\"linesremoved\"), res.getString(\"props\"), res.getInt(\"rev\"));\n            changeSetDetails.add(changeSetDetail);\n        }\n        if (res != null)\n            res.close();\n        return changeSetDetails;\n    }\n\n    private static Set<User> getProjectUsers(int projectID) throws SQLException {\n        Set<String> usersID = new HashSet<String>();\n        Set<User> users = new HashSet<User>();\n        String sqlStmt = QueryBuilder.selectProjectUsers(projectID);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            usersID.add(res.getString(\"userid\"));\n        }\n        if (res != null)\n            res.close();\n        for (String userID : usersID) {\n            users.add(getUserByUserName(userID));\n        }\n        return users;\n    }\n}\n",
  "classDeclarationCode": "public class DataManager {\n\n    private static final String databaseDriver = \"com.mysql.jdbc.Driver\";\n\n    private static final String databaseName = \"jdbc:mysql://hypatia.cs.ualberta.ca/wikidev_ucosp\";\n\n    // private static final String databaseName = \"jdbc:mysql://hypatia.cs.ualberta.ca/c301f09_wikidev\";\n    private static final String[] entityTypes = { \"wikidev_changesets\", \"wikidev_tickets\", \"mw_page\", \"wikidev_messages\" };\n\n    public static final long WEEK_INTERVAL_IN_MILLIS = 604800000;\n\n    private static Connection conn;\n\n    private static Statement statement;\n\n    public static Set<Integer> userIDs;\n\n    public static Set<User> users;\n\n    public static Set<String> usernames;\n\n    public static Set<Integer> projectIDs;\n\n    public static Set<Project> projects;\n\n    public static Set<String> artifactURLs;\n\n    public static Set<IArtifact> allArtifacts;\n\n    public static Set<String> classNames;\n\n    public static Set<SourceClass> classes;\n\n    public static HashMap<Integer, Integer> ticketids;\n\n    public static Set<Ticket> tickets;\n\n    public static Set<Integer> systems;\n\n    public static Set<ChangeSet> changesets;\n\n    public static Set<Integer> commBuildingIDs;\n\n    public static Set<CommunicationBuildingData> commBuildings;\n\n    public static Set<Integer> fileBuildingIDs;\n\n    public static Set<FileBuildingData> fileBuildings;\n\n    public DataManager() throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        conn = DriverManager.getConnection(databaseName, \"wikidev\", \"wikidev989\");\n        statement = conn.createStatement();\n    }\n\n    public static void openTheConnection() throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        conn = DriverManager.getConnection(databaseName, \"wikidev_ucosp\", \"XvWRSVaEVLeSH2fW \");\n        // conn=DriverManager.getConnection(databaseName, \"fokaefs\", \"filimon9786#7@gr\");\n        statement = conn.createStatement();\n        userIDs = new HashSet<Integer>();\n        users = new HashSet<User>();\n        projectIDs = new HashSet<Integer>();\n        projects = new HashSet<Project>();\n        artifactURLs = new HashSet<String>();\n        allArtifacts = new HashSet<IArtifact>();\n        classNames = new HashSet<String>();\n        classes = new HashSet<SourceClass>();\n        ticketids = new HashMap<Integer, Integer>();\n        tickets = new HashSet<Ticket>();\n        usernames = new HashSet<String>();\n        systems = new HashSet<Integer>();\n        changesets = new HashSet<ChangeSet>();\n        commBuildingIDs = new HashSet<Integer>();\n        commBuildings = new HashSet<CommunicationBuildingData>();\n        fileBuildingIDs = new HashSet<Integer>();\n        fileBuildings = new HashSet<FileBuildingData>();\n    }\n\n    public static void openTheConnection(String username, String password, String databaseName) throws Exception {\n        Class.forName(databaseDriver).newInstance();\n        try {\n            conn = DriverManager.getConnection(databaseName, username, password);\n        } catch (SQLException e) {\n            System.out.println(e.getMessage());\n            System.exit(1);\n        }\n        statement = conn.createStatement();\n        userIDs = new HashSet<Integer>();\n        users = new HashSet<User>();\n        projectIDs = new HashSet<Integer>();\n        projects = new HashSet<Project>();\n        artifactURLs = new HashSet<String>();\n        allArtifacts = new HashSet<IArtifact>();\n        classNames = new HashSet<String>();\n        classes = new HashSet<SourceClass>();\n        ticketids = new HashMap<Integer, Integer>();\n        tickets = new HashSet<Ticket>();\n        usernames = new HashSet<String>();\n        systems = new HashSet<Integer>();\n        changesets = new HashSet<ChangeSet>();\n        commBuildingIDs = new HashSet<Integer>();\n        commBuildings = new HashSet<CommunicationBuildingData>();\n        fileBuildingIDs = new HashSet<Integer>();\n        fileBuildings = new HashSet<FileBuildingData>();\n    }\n\n    public static void closeTheConnection() throws SQLException {\n        if (statement != null)\n            statement.close();\n        if (conn != null)\n            conn.close();\n    }\n\n    public static Timestamp getTheEarlierstTimeOfActivity() throws SQLException {\n        String sqlStmt = QueryBuilder.selectTheEarliestTimeOfActivity();\n        ResultSet res = null;\n        Timestamp timestamp = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            timestamp = res.getTimestamp(\"time\");\n        }\n        if (res != null)\n            res.close();\n        return timestamp;\n    }\n\n    public static Timestamp getTheLatestTimeOfActivity() throws SQLException {\n        String sqlStmt = QueryBuilder.selectTheLatestTimeOfActivity();\n        ResultSet res = null;\n        Timestamp timestamp = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            timestamp = res.getTimestamp(\"time\");\n        }\n        if (res != null)\n            res.close();\n        return timestamp;\n    }\n\n    public static void writeCluster(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        String sqlStmt = QueryBuilder.insertIntoClusters(cluster, project.getProjectName());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeArtifactInCluster(cluster);\n        DataManager.writeUserInCluster(cluster);\n    }\n\n    public static void writeClusterPerProject(int projectid, int clustered, int total, String fromdate, String todate, String cluster_set_name, double threshold) throws SQLException {\n        Project project = DataManager.getProjectByID(projectid);\n        String sqlStmt = QueryBuilder.insertClusterPerProject(clustered, project.getProjectName(), fromdate, todate, total, cluster_set_name, threshold);\n        statement.executeUpdate(sqlStmt);\n    }\n\n    public static void writeUserInCluster(Cluster cluster) throws SQLException {\n        int clusterid = DataManager.getClusterID(cluster);\n        for (User user : cluster.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserInCluster(user.getUserName(), clusterid);\n            // System.out.println(sqlStmt);\n            statement.executeUpdate(sqlStmt);\n        }\n    }\n\n    public static int getClusterID(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        String sqlStmt = QueryBuilder.selectClusterID(cluster, project.getProjectName());\n        ResultSet res = null;\n        int clusterid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            clusterid = res.getInt(\"clusterid\");\n        }\n        if (res != null)\n            res.close();\n        return clusterid;\n    }\n\n    private static Cluster getClusterByID(int clusterid) throws SQLException {\n        String sqlStmt = QueryBuilder.selectClusterByID(clusterid);\n        ResultSet res = null;\n        Cluster cluster = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            cluster = new Cluster(res.getTimestamp(\"to_date\"), res.getString(\"project_name\"), res.getDouble(\"threshold\"), res.getString(\"terms\"), res.getInt(\"clusterid\"));\n        }\n        if (res != null)\n            res.close();\n        cluster.setProject(DataManager.getProjectByName(cluster.getProjectname()).getProjectID());\n        return cluster;\n    }\n\n    public static void writeCommunicationsBuildingData(CommunicationBuildingData building) throws SQLException {\n        String lastEditor = \"\";\n        if (building.getLastEditor() != null) {\n            lastEditor += building.getLastEditor().getUserName();\n        }\n        String sqlStmt = QueryBuilder.insertCommunicationsBuildingData(building.getType(), building.getArtifact_id(), building.getWeek().toString(), building.getHeight(), building.getNeighborhoodX(), building.getNeighborhoodY(), building.getCityBlock(), building.getUrl(), building.getProjectid(), lastEditor, building.getCreated(), building.getLastModified());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeCommunicationsUserData(building);\n    }\n\n    public static void writeFilesBuildingData(FileBuildingData building) throws SQLException {\n        String lastEditor = \"\";\n        if (building.getLastEditor() != null) {\n            lastEditor += building.getLastEditor().getUserName();\n        }\n        String sqlStmt = QueryBuilder.insertFilesBuildingData(building.getType(), building.getWeek().toString(), building.getHeight(), building.getNeighborhoodX(), building.getNeighborhoodY(), building.getCityBlock(), building.getUrl(), building.getProjectid(), lastEditor, building.getCreated(), building.getLastModified());\n        statement.executeUpdate(sqlStmt);\n        DataManager.writeFilesUserData(building);\n    }\n\n    private static ArrayList<Integer> getClusterIDsByBuilding(CommunicationBuildingData building) throws SQLException {\n        ArrayList<Integer> clusterIDs = new ArrayList<Integer>();\n        String sqlStmt = QueryBuilder.selectClusterIDsByBuilding(building);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            clusterIDs.add(res.getInt(\"clusterid\"));\n        }\n        if (res != null)\n            res.close();\n        return clusterIDs;\n    }\n\n    private static HashMap<IArtifact, Double> getArtifactsInCluster(Cluster cluster) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        HashMap<IArtifact, Double> finalArtifacts = new HashMap<IArtifact, Double>();\n        String sqlStmt = QueryBuilder.selectArtifactsInCluster(cluster);\n        IArtifact artifact = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            artifact = new IArtifact(res.getString(\"type\"), res.getInt(\"id\"));\n            artifacts.add(artifact);\n        }\n        if (res != null)\n            res.close();\n        for (IArtifact anArtifact : artifacts) {\n            finalArtifacts.put(DataManager.getArtifactByTypeAndID(anArtifact, cluster.getProject()), cluster.getThreshold());\n        }\n        return finalArtifacts;\n    }\n\n    private static IArtifact getArtifactByTypeAndID(IArtifact anArtifact, int projectid) throws SQLException {\n        Project project = DataManager.getProjectByID(projectid);\n        String sqlStmt = QueryBuilder.selectArtifactByTypeAndID(anArtifact.getType(), anArtifact.getId(), projectid);\n        ResultSet res = null;\n        IArtifact artifact = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            if (anArtifact.getType().equals(\"ChangeSet\")) {\n                artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project_id\"));\n            } else if (anArtifact.getType().equals(\"Ticket\")) {\n                artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n            } else if (anArtifact.getType().equals(\"Wiki\")) {\n                artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n            } else if (anArtifact.getType().equals(\"Message\")) {\n                artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                ;\n            }\n        }\n        if (res != null)\n            res.close();\n        if (artifact instanceof ChangeSet) {\n            ChangeSet changeSet = (ChangeSet) artifact;\n            changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n            changeSet.setProject(project);\n            changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n            for (ChangeSetDetail detail : changeSet.getChangesetDetails()) {\n                detail.setTimestamp(changeSet.getTimestamp());\n            }\n            changeSet.setAuthorForChangeSetDetails();\n            changeSet.setType(\"ChangeSet\");\n            project.addChangeset(changeSet);\n        } else if (artifact instanceof Ticket) {\n            Ticket ticket = (Ticket) artifact;\n            ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n            ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n            ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n            ticket.setProject(project);\n            ticket.setType(\"Ticket\");\n            project.addTicket(ticket);\n        } else if (artifact instanceof Message) {\n            Message communication = (Message) artifact;\n            User user = getUserByUserName(communication.getUser_name());\n            communication.setOwner(user);\n            user.setUserRealName(communication.getAuthor());\n            communication.setProject(project);\n            communication.setType(\"Message\");\n            project.addMessage(communication);\n        } else if (artifact instanceof Wiki) {\n            Wiki wiki = (Wiki) artifact;\n            wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n            wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n            wiki.setProjectID(wiki.getProject().getProjectID());\n            wiki.setType(\"Wiki\");\n        }\n        return artifact;\n    }\n\n    public static ClusterData getClusteredBuildings(CommunicationBuildingData building) throws SQLException {\n        ClusterData clusterData = new ClusterData(building.getWeek());\n        ArrayList<Integer> clusterIDs = DataManager.getClusterIDsByBuilding(building);\n        ArrayList<Cluster> clusters = new ArrayList<Cluster>();\n        for (Integer id : clusterIDs) {\n            clusters.add(DataManager.getClusterByID(id));\n        }\n        for (Cluster cluster : clusters) {\n            HashMap<IArtifact, Double> artifacts = DataManager.getArtifactsInCluster(cluster);\n            clusterData.addArtifacts(artifacts);\n            HashMap<String, Double> terms = new HashMap<String, Double>();\n            for (String term : cluster.getWords()) {\n                terms.put(term, cluster.getThreshold());\n            }\n            clusterData.addTerms(terms);\n        }\n        clusterData.calculateBuildingData();\n        return clusterData;\n    }\n\n    public static int getCommunicationsBuildingID(CommunicationBuildingData building) throws SQLException {\n        String sqlStmt = QueryBuilder.selectCommunicationsBuildingID(building, building.getProjectid());\n        ResultSet res = null;\n        int buildingid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            buildingid = res.getInt(\"building_id\");\n        }\n        if (res != null)\n            res.close();\n        return buildingid;\n    }\n\n    public static int getFilesBuildingID(FileBuildingData building) throws SQLException {\n        String sqlStmt = QueryBuilder.selectFilesBuildingID(building, building.getProjectid());\n        ResultSet res = null;\n        int buildingid = 0;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            buildingid = res.getInt(\"building_id\");\n        }\n        if (res != null)\n            res.close();\n        return buildingid;\n    }\n\n    public static void writeCommunicationsUserData(CommunicationBuildingData building) throws SQLException {\n        int buildingid = DataManager.getCommunicationsBuildingID(building);\n        for (UserData user : building.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserData(buildingid, user.getUsername(), user.getR(), user.getG(), user.getB(), user.getContribution(), user.getWeek().toString(), user.getCityType());\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static void writeFilesUserData(FileBuildingData building) throws SQLException {\n        int buildingid = DataManager.getFilesBuildingID(building);\n        for (UserData user : building.getUsers()) {\n            String sqlStmt = QueryBuilder.insertUserData(buildingid, user.getUsername(), user.getR(), user.getG(), user.getB(), user.getContribution(), user.getWeek().toString(), user.getCityType());\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static void writeArtifactInCluster(Cluster cluster) throws SQLException {\n        Project project = DataManager.getProjectByID(cluster.getProject());\n        int clusterid = DataManager.getClusterID(cluster);\n        for (IArtifact artifact : cluster.getArtifacts()) {\n            String type = \"\";\n            int id = 0;\n            ClusterPoint point = cluster.getCoordinates().get(artifact);\n            if (artifact instanceof ChangeSet) {\n                type = \"ChangeSet\";\n                ChangeSet changeset = (ChangeSet) artifact;\n                id = changeset.getRevision();\n            } else if (artifact instanceof Ticket) {\n                type = \"Ticket\";\n                Ticket ticket = (Ticket) artifact;\n                id = ticket.getTicketID();\n            } else if (artifact instanceof Message) {\n                type = \"Message\";\n                Message message = (Message) artifact;\n                id = message.getCommunicationID();\n            } else if (artifact instanceof Wiki) {\n                type = \"Wiki\";\n                Wiki wiki = (Wiki) artifact;\n                id = wiki.getPage_id();\n            }\n            String sqlStmt = QueryBuilder.insertArtifactInCluster(type, clusterid, project.getProjectName(), id, point);\n            statement.executeUpdate(sqlStmt);\n            // conn.commit();\n        }\n    }\n\n    public static ArrayList<CommunicationBuildingData> getCommmunicationCitySnapshot(Timestamp timestamp, int projectid) throws SQLException {\n        ArrayList<CommunicationBuildingData> buildings = new ArrayList<CommunicationBuildingData>();\n        String sqlStmt = QueryBuilder.selectCommunicationCitySnapshot(timestamp, projectid);\n        CommunicationBuildingData building = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new CommunicationBuildingData(res.getString(\"type\"), res.getInt(\"artifact_id\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (CommunicationBuildingData data : buildings) {\n            int id = DataManager.getCommunicationsBuildingID(data);\n            data.setUsers(DataManager.getUsersForBuilding(id, CityLayout.CITY_TYPE));\n            data.setLastEditor(DataManager.getUserByUserName(data.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static ArrayList<FileBuildingData> getFileCitySnapshot(Timestamp timestamp, int projectid) throws SQLException {\n        ArrayList<FileBuildingData> buildings = new ArrayList<FileBuildingData>();\n        String sqlStmt = QueryBuilder.selectFileCitySnapshot(timestamp, projectid);\n        FileBuildingData building = null;\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new FileBuildingData(res.getString(\"type\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (FileBuildingData data : buildings) {\n            int id = DataManager.getFilesBuildingID(data);\n            data.setUsers(DataManager.getUsersForBuilding(id, IndustrialLayout.CITY_TYPE));\n            data.setLastEditor(DataManager.getUserByUserName(data.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    private static ArrayList<UserData> getUsersForBuilding(int id, String cityType) throws SQLException {\n        ArrayList<UserData> users = new ArrayList<UserData>();\n        UserData user = null;\n        String sqlStmt = QueryBuilder.selectUsersForBuilding(id, cityType);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            user = new UserData(res.getString(\"username\"), res.getInt(\"R\"), res.getInt(\"G\"), res.getInt(\"B\"), res.getDouble(\"contribution\"), res.getTimestamp(\"week\"), res.getString(\"city_type\"));\n            users.add(user);\n        }\n        if (res != null)\n            res.close();\n        return users;\n    }\n\n    public static ArrayList<CommunicationBuildingData> getCommunicationsBuildingHistory(String type, int artifact_id, int projectid) throws SQLException {\n        ArrayList<CommunicationBuildingData> buildings = new ArrayList<CommunicationBuildingData>();\n        CommunicationBuildingData building = null;\n        String sqlStmt = QueryBuilder.selectCommunicationsBuildingHistory(type, artifact_id, projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new CommunicationBuildingData(res.getString(\"type\"), res.getInt(\"artifact_id\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (CommunicationBuildingData aBuilding : buildings) {\n            int id = getCommunicationsBuildingID(aBuilding);\n            aBuilding.setUsers(getUsersForBuilding(id, CityLayout.CITY_TYPE));\n            aBuilding.setLastEditor(DataManager.getUserByUserName(aBuilding.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static ArrayList<FileBuildingData> getFilesBuildingHistory(String url) throws SQLException {\n        ArrayList<FileBuildingData> buildings = new ArrayList<FileBuildingData>();\n        FileBuildingData building = null;\n        String sqlStmt = QueryBuilder.selectFilesBuildingHistory(url);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            building = new FileBuildingData(res.getString(\"type\"), res.getTimestamp(\"week\"), res.getInt(\"height\"), res.getInt(\"neighborhoodX\"), res.getInt(\"neighborhoodY\"), res.getInt(\"cityBlock\"), res.getString(\"url\"), res.getInt(\"project_id\"), res.getInt(\"building_id\"), res.getString(\"last_editor\"), res.getTimestamp(\"created\"), res.getTimestamp(\"last_modified\"));\n            buildings.add(building);\n        }\n        if (res != null)\n            res.close();\n        for (FileBuildingData aBuilding : buildings) {\n            int id = getFilesBuildingID(aBuilding);\n            aBuilding.setUsers(getUsersForBuilding(id, IndustrialLayout.CITY_TYPE));\n            aBuilding.setLastEditor(DataManager.getUserByUserName(aBuilding.getLastEditorString()));\n        }\n        return buildings;\n    }\n\n    public static int getCommunicationsCitySize(int projectid) throws SQLException {\n        int size = 3;\n        String sqlStmt = QueryBuilder.selectCommunicationsCitySize(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            size += res.getInt(\"size\");\n        }\n        if (res != null)\n            res.close();\n        return size;\n    }\n\n    public static int getFilesCitySize(int projectid) throws SQLException {\n        int size = 3;\n        String sqlStmt = QueryBuilder.selectFilesCitySize(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            size += res.getInt(\"size\");\n        }\n        if (res != null)\n            res.close();\n        return size;\n    }\n\n    public static Project getProjectByName(String projectName) throws SQLException {\n        boolean found = false;\n        Project aProject = null;\n        for (Project project : projects) {\n            if (project.getProjectName().equals(projectName)) {\n                aProject = project;\n                found = true;\n            }\n        }\n        if (!found) {\n            String sqlStmt = QueryBuilder.selectProjectByName(projectName);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                aProject = new Project(res.getInt(\"projectid\"), res.getString(\"projectname\"));\n            }\n            if (res != null)\n                res.close();\n            aProject.setUsers(getProjectUsers(aProject.getProjectID()));\n            aProject.setSystem(getExternalSystemByProjectID(aProject.getProjectID()));\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(aProject.getSystem());\n        }\n        return aProject;\n    }\n\n    public static Project getProjectByID(int projectID) throws SQLException {\n        Project aProject = null;\n        if (!projectIDs.contains(projectID)) {\n            String sqlStmt = QueryBuilder.selectProjectByID(projectID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                aProject = new Project(res.getInt(\"projectid\"), res.getString(\"projectname\"));\n            }\n            if (res != null)\n                res.close();\n            aProject.setUsers(getProjectUsers(projectID));\n            aProject.setSystem(getExternalSystemByProjectID(projectID));\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(aProject.getSystem());\n        } else {\n            for (Project project : projects) {\n                if (project.getProjectID() == projectID) {\n                    aProject = project;\n                }\n            }\n        }\n        return aProject;\n    }\n\n    public static Project getProjectByExternalSystem(int system) throws SQLException {\n        Project aProject = null;\n        int projectid = 0;\n        if (!systems.contains(system)) {\n            String sqlStmt = QueryBuilder.selectProjectIDByExternalSystem(system);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                projectid = res.getInt(\"project\");\n            }\n            if (res != null)\n                res.close();\n            aProject = getProjectByID(projectid);\n            aProject.setUsers(getProjectUsers(projectid));\n            aProject.setSystem(system);\n            projects.add(aProject);\n            projectIDs.add(aProject.getProjectID());\n            systems.add(system);\n        } else {\n            for (Project project : projects) {\n                if (project.getSystem() == system) {\n                    aProject = project;\n                }\n            }\n        }\n        return aProject;\n    }\n\n    public static int getExternalSystemByProjectID(int projectid) throws SQLException {\n        int system = 0;\n        String sqlStmt = QueryBuilder.selectExternalSystemByProjectID(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            system = res.getInt(\"externalsystem\");\n        }\n        if (res != null)\n            res.close();\n        return system;\n    }\n\n    public static User getUserByID(int userID) throws SQLException {\n        User user = null;\n        if (!userIDs.contains(userID)) {\n            String sqlStmt = QueryBuilder.selectUserByID(userID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                user = new User(res.getInt(\"user_id\"), res.getString(\"user_name\"), res.getString(\"user_real_name\"));\n            }\n            if (res != null)\n                res.close();\n            users.add(user);\n            userIDs.add(userID);\n            usernames.add(user.getUserName());\n        } else {\n            for (User aUser : users) {\n                if (aUser.getUserID() == userID) {\n                    user = aUser;\n                }\n            }\n        }\n        return user;\n    }\n\n    public static Ticket getTicketByDrID(int project, int ticketid) throws SQLException {\n        Ticket ticket = null;\n        if (!ticketids.containsKey(ticketid) || ticketids.get(ticketid) != null) {\n            String sqlStmt = QueryBuilder.selectTicketByDrID(ticketid, project);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                ticket = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n            }\n            if (res != null)\n                res.close();\n            ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n            ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n            ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n            ticket.setProject(getProjectByID(ticket.getProjectID()));\n            ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n            allArtifacts.add(ticket);\n        } else {\n            for (Ticket aTicket : tickets) {\n                if (aTicket.getDr_id() == ticketid && aTicket.getProjectID() == project) {\n                    ticket = aTicket;\n                }\n            }\n        }\n        return ticket;\n    }\n\n    public static ArrayList<User> getUsersPerProject(int projectid) throws SQLException {\n        ArrayList<User> users = new ArrayList<User>();\n        ArrayList<String> userNames = new ArrayList<String>();\n        String sqlStmt = QueryBuilder.selectUsersPerProject(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            userNames.add(res.getString(\"userid\"));\n        }\n        if (res != null)\n            res.close();\n        for (String username : userNames) {\n            users.add(getUserByUserName(username));\n        }\n        return users;\n    }\n\n    public static User getUserByUserName(String userName) throws SQLException {\n        User user = null;\n        userName = userName.toLowerCase();\n        if (!usernames.contains(userName)) {\n            String sqlStmt = QueryBuilder.selectUserByUserName(userName);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                user = new User(res.getInt(\"user_id\"), res.getString(\"user_name\").toLowerCase(), res.getString(\"user_real_name\"));\n            }\n            if (res != null)\n                res.close();\n            if (user != null) {\n                users.add(user);\n                userIDs.add(user.getUserID());\n                usernames.add(userName);\n            } else {\n                user = new User(userName);\n                users.add(user);\n                userIDs.add(user.getUserID());\n                usernames.add(userName);\n            }\n        } else {\n            for (User aUser : users) {\n                if (aUser.getUserName().equalsIgnoreCase(userName)) {\n                    user = aUser;\n                    break;\n                }\n            }\n        }\n        return user;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsAfterTimestamp(String timestamp) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String sqlStmt = QueryBuilder.selectArtifactsAfterTimestamp(entityType, timestamp);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"revision\"), res.getInt(\"project\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_page\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(getProjectByID(changeSet.getExternalSystemID()));\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(getProjectByID(ticket.getProjectID()));\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(getProjectByID(communication.getProject_id()));\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    private static String getProjectNamespaceByNamespaceID(int page_namespace_id) throws SQLException {\n        String namespace = \"\";\n        String sqlStmt = QueryBuilder.selectProjectNamespaceByNamespaceID(page_namespace_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            namespace = res.getString(\"nsName\");\n        }\n        if (res != null)\n            res.close();\n        return namespace;\n    }\n\n    private static String getProjectNamespaceByID(int projectid) throws SQLException {\n        String namespace = \"\";\n        String sqlStmt = QueryBuilder.selectProjectNamespaceByID(projectid);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            namespace = res.getString(\"projectname\");\n        }\n        if (res != null)\n            res.close();\n        return namespace;\n    }\n\n    private static int getProjectNamespaceIDByProjectID(int projectid) throws SQLException {\n        int id = 0;\n        String namespace = getProjectNamespaceByID(projectid);\n        String sqlStmt = QueryBuilder.selectProjectNamespaceIDbyNamespace(namespace);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            id = res.getInt(\"nsId\");\n        }\n        if (res != null)\n            res.close();\n        return id;\n    }\n\n    private static ArrayList<WikiRevision> getRevisionsByWikiID(int page_id) throws SQLException {\n        ArrayList<WikiRevision> revisions = new ArrayList<WikiRevision>();\n        String sqlStmt = QueryBuilder.selectRevisionsByWikiID(page_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            WikiRevision wikiRevision = new WikiRevision(res.getInt(\"rev_id\"), res.getInt(\"rev_page\"), res.getInt(\"rev_text_id\"), res.getString(\"rev_user_text\"), res.getTimestamp(\"rev_timestamp\"));\n            revisions.add(wikiRevision);\n        }\n        if (res != null)\n            res.close();\n        for (WikiRevision revision : revisions) {\n            revision.setRev_user(getUserByUserName(revision.getRev_user_text()));\n            revision.setRev_text(getRevisionTextByRevisionID(revision.getRev_id()));\n        }\n        return revisions;\n    }\n\n    private static String getRevisionTextByRevisionID(int rev_id) throws SQLException {\n        String text = \"\";\n        String sqlStmt = QueryBuilder.selectRevisionTextByRevisionID(rev_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            text = res.getString(1);\n        }\n        if (res != null)\n            res.close();\n        return text;\n    }\n\n    public static ArrayList<ChangeSet> getAllChangesetsForProject(int system) throws SQLException {\n        ArrayList<ChangeSet> changesets = new ArrayList<ChangeSet>();\n        Project project = getProjectByExternalSystem(system);\n        ChangeSet aChangeset = null;\n        String sqlStmt = QueryBuilder.selectAllChangesetsForProject(system);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            aChangeset = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project\"));\n            changesets.add(aChangeset);\n            DataManager.changesets.add(aChangeset);\n        }\n        if (res != null)\n            res.close();\n        for (ChangeSet changeset : changesets) {\n            changeset.setOwner(getUserByUserName(changeset.getExternalAuthorUserName()));\n            changeset.setProject(project);\n            changeset.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeset.getRevision(), changeset.getExternalSystemID()));\n            changeset.setAuthorForChangeSetDetails();\n            project.addChangeset(changeset);\n        }\n        return changesets;\n    }\n\n    private static String removeChar(String s, char c) {\n        String r = \"\";\n        for (int i = 0; i < s.length(); i++) {\n            if (s.charAt(i) != c)\n                r += s.charAt(i);\n        }\n        return r;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsBetweenDates(String timestamp1, String timestamp2, int projectid) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        Project project = getProjectByID(projectid);\n        int namespaceID = DataManager.getProjectNamespaceIDByProjectID(projectid);\n        for (ChangeSet changeset : changesets) {\n            if (changeset.getTimestamp().compareTo(Timestamp.valueOf(timestamp1)) >= 0 && changeset.getTimestamp().compareTo(Timestamp.valueOf(timestamp2)) <= 0) {\n                finalArtifacts.add(changeset);\n            }\n        }\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String nullString = \"\";\n            if (entityType.equals(\"mw_page\")) {\n                timestamp1 = removeChar(timestamp1, '-');\n                timestamp1 = removeChar(timestamp1, ' ');\n                timestamp1 = removeChar(timestamp1, ':');\n                timestamp2 = removeChar(timestamp2, '-');\n                timestamp2 = removeChar(timestamp2, ' ');\n                timestamp2 = removeChar(timestamp2, ':');\n            }\n            String sqlStmt = QueryBuilder.selectArtifactsForProjectBetweenDates(entityType, timestamp1, timestamp2, projectid, namespaceID);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project_id\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_page\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(project);\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                for (ChangeSetDetail detail : changeSet.getChangesetDetails()) {\n                    detail.setTimestamp(changeSet.getTimestamp());\n                }\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n                project.addChangeset(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(project);\n                project.addTicket(ticket);\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(project);\n                project.addMessage(communication);\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setOwner(wiki.getRevisions().get(0).getRev_user());\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n                wiki.setProjectID(wiki.getProject().getProjectID());\n                finalArtifacts.add(wiki);\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    public static ArrayList<IArtifact> getArtifactsForProject(int projectid) throws SQLException {\n        ArrayList<IArtifact> artifacts = new ArrayList<IArtifact>();\n        ArrayList<IArtifact> finalArtifacts = new ArrayList<IArtifact>();\n        Project project = getProjectByID(projectid);\n        IArtifact artifact = null;\n        for (int i = 0; i < entityTypes.length; i++) {\n            String entityType = entityTypes[i];\n            String sqlStmt = QueryBuilder.selectArtifactsForProject(entityType, projectid);\n            ResultSet res = null;\n            res = statement.executeQuery(sqlStmt);\n            while (res.next()) {\n                if (entityType.equals(\"wikidev_changesets\")) {\n                    artifact = new ChangeSet(res.getInt(\"id\"), res.getString(\"comment\"), res.getString(\"externalauthor\"), res.getInt(\"externalsystem_id\"), res.getTimestamp(\"timestamp\"), res.getInt(\"rev\"), res.getInt(\"project\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_tickets\")) {\n                    artifact = new Ticket(res.getTimestamp(\"created\"), res.getString(\"description\"), res.getTimestamp(\"last_modified\"), res.getString(\"owner_name\"), res.getString(\"reporter\"), res.getString(\"summary\"), res.getInt(\"id\"), res.getInt(\"project_id\"), res.getInt(\"project_ticket_id\"), res.getString(\"priority\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"mw_wiki\")) {\n                    artifact = new Wiki(res.getInt(\"page_id\"), res.getInt(\"page_namespace\"), res.getString(\"page_title\"), res.getTimestamp(\"page_touched\"));\n                    artifacts.add(artifact);\n                } else if (entityType.equals(\"wikidev_messages\")) {\n                    artifact = new Message(res.getString(\"address\"), res.getString(\"author\"), res.getString(\"body\"), res.getInt(\"id\"), res.getInt(\"deleted\"), res.getString(\"mid_header\"), res.getInt(\"project_id\"), res.getString(\"subject\"), res.getTimestamp(\"date\"), res.getString(\"user_name\"), res.getString(\"refid_header\"));\n                    ;\n                    artifacts.add(artifact);\n                }\n            }\n            if (res != null)\n                res.close();\n        }\n        for (IArtifact anArtifact : artifacts) {\n            if (anArtifact instanceof ChangeSet) {\n                ChangeSet changeSet = (ChangeSet) anArtifact;\n                changeSet.setOwner(getUserByUserName(changeSet.getExternalAuthorUserName()));\n                changeSet.setProject(project);\n                changeSet.setChangesetDetails(getChangeSetDetailsByRevAndProject(changeSet.getRevision(), changeSet.getExternalSystemID()));\n                changeSet.setAuthorForChangeSetDetails();\n                finalArtifacts.add(changeSet);\n                project.addChangeset(changeSet);\n            } else if (anArtifact instanceof Ticket) {\n                Ticket ticket = (Ticket) anArtifact;\n                ticket.setOwner(getUserByUserName(ticket.getOwnerName()));\n                ticket.setReporter(getUserByUserName(ticket.getReporterName()));\n                ticket.setTicketChanges(getTicketChangesByTicketID(ticket.getTicketID()));\n                ticket.setProject(project);\n                project.addTicket(ticket);\n                ticketids.put(ticket.getDr_id(), ticket.getProjectID());\n                tickets.add(ticket);\n                finalArtifacts.add(ticket);\n            } else if (anArtifact instanceof Message) {\n                Message communication = (Message) anArtifact;\n                User user = getUserByUserName(communication.getUser_name());\n                communication.setOwner(user);\n                user.setUserRealName(communication.getAuthor());\n                communication.setProject(project);\n                project.addMessage(communication);\n                finalArtifacts.add(communication);\n            } else if (anArtifact instanceof Wiki) {\n                Wiki wiki = (Wiki) anArtifact;\n                wiki.setRevisions(getRevisionsByWikiID(wiki.getPage_id()));\n                wiki.setProject(DataManager.getProjectByName(getProjectNamespaceByNamespaceID(wiki.getPage_namespace_id())));\n                finalArtifacts.add(wiki);\n            }\n        }\n        allArtifacts.addAll(finalArtifacts);\n        return finalArtifacts;\n    }\n\n    public static ArrayList<TicketChange> getTicketChangesByTicketID(int ticketID) throws SQLException {\n        ArrayList<TicketChange> ticketChanges = new ArrayList<TicketChange>();\n        String sqlStmt = QueryBuilder.selectTicketChangesByTicketID(ticketID);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            TicketChange ticketChange = new TicketChange(res.getString(\"author_name\"), res.getString(\"field_changed\"), res.getInt(\"id\"), res.getString(\"new_value\"), res.getString(\"old_value\"), res.getInt(\"project_ticket_id\"), res.getInt(\"ticket_id\"), res.getInt(\"project_id\"), res.getTimestamp(\"change_time\"));\n            ticketChanges.add(ticketChange);\n        }\n        if (res != null)\n            res.close();\n        for (TicketChange ticketChange : ticketChanges) {\n            ticketChange.setExternalAuthor(getUserByUserName(ticketChange.getExternalAuthorUsername()));\n        }\n        return ticketChanges;\n    }\n\n    public static ArrayList<ChangeSetDetail> getChangeSetDetailsByRevAndProject(int rev, int externalsystem_id) throws SQLException {\n        ArrayList<ChangeSetDetail> changeSetDetails = new ArrayList<ChangeSetDetail>();\n        String sqlStmt = QueryBuilder.selectChangeSetDetailByRevAndProject(rev, externalsystem_id);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            ChangeSetDetail changeSetDetail = new ChangeSetDetail(res.getString(\"changetype\"), res.getInt(\"externalsystem_id\"), res.getString(\"filename\"), res.getInt(\"id\"), res.getString(\"kind\"), res.getInt(\"linesadded\"), res.getInt(\"lineschanged\"), res.getInt(\"linesremoved\"), res.getString(\"props\"), res.getInt(\"rev\"));\n            changeSetDetails.add(changeSetDetail);\n        }\n        if (res != null)\n            res.close();\n        return changeSetDetails;\n    }\n\n    private static Set<User> getProjectUsers(int projectID) throws SQLException {\n        Set<String> usersID = new HashSet<String>();\n        Set<User> users = new HashSet<User>();\n        String sqlStmt = QueryBuilder.selectProjectUsers(projectID);\n        ResultSet res = null;\n        res = statement.executeQuery(sqlStmt);\n        while (res.next()) {\n            usersID.add(res.getString(\"userid\"));\n        }\n        if (res != null)\n            res.close();\n        for (String userID : usersID) {\n            users.add(getUserByUserName(userID));\n        }\n        return users;\n    }\n}",
  "subClasses": []
}