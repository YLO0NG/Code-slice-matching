{
  "fullClassName": "ca.ualberta.cs.serl.wikidev.city3d.IndustrialLayout",
  "className": "IndustrialLayout",
  "index": 21,
  "modifier": "[public ]",
  "extend": "[Layout]",
  "implement": "[]",
  "packageName": "ca.ualberta.cs.serl.wikidev.city3d",
  "packageDeclaration": "package ca.ualberta.cs.serl.wikidev.city3d;",
  "classSignature": "public class IndustrialLayout",
  "hasConstructor": true,
  "isPublic": true,
  "isInterface": false,
  "isAbstract": false,
  "imports": [
    "import java.io.BufferedWriter;",
    "import java.io.FileWriter;",
    "import java.io.IOException;",
    "import java.sql.SQLException;",
    "import java.sql.Timestamp;",
    "import java.util.ArrayList;",
    "import java.util.HashMap;",
    "import java.util.TreeSet;",
    "import ca.ualberta.cs.serl.wikidev.DataManager;",
    "import ca.ualberta.cs.serl.wikidev.User;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.ChangeSet;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.ChangeSetDetail;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.IArtifact;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Message;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.SVNFile;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Ticket;",
    "import ca.ualberta.cs.serl.wikidev.artifacts.Wiki;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.CommunicationBuildingData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.FileBuildingData;",
    "import ca.ualberta.cs.serl.wikidev.city3d.animation.UserData;",
    "import static org.math.array.DoubleArray.deleteRows;",
    "import static org.math.array.DoubleArray.deleteColumns;"
  ],
  "fields": [
    "public static final String CITY_TYPE = \"files\";",
    "private HashMap<ChangeSet, ArrayList<SVNFile>> filesPerChangeset;",
    "private ArrayList<SVNFile> totalFiles;",
    "private ArrayList<ChangeSet> changesets;",
    "private int projectid;"
  ],
  "superClasses": [
    "Layout"
  ],
  "implementedTypes": [],
  "methodSigs": {
    "getFileCount(ArrayList)": "0",
    "getChangesForFileBeforeDate(SVNFile, Timestamp)": "1",
    "setLastEditorAndTimeLastModifiedBeforeDate(SVNFile, Timestamp)": "2",
    "setTimeCreatedBeforeDate(SVNFile, Timestamp)": "3",
    "decreaseIndices(ArrayList)": "4",
    "getSupportDistanceMatrix(int)": "5",
    "getCosineDistanceMatrix(int)": "6",
    "printDistanceMatrix(double[][])": "7",
    "getUserContributionBeforeDate(SVNFile, Timestamp, ArrayList)": "8",
    "prepareToWriteCitySnapshots(Timestamp, Timestamp)": "9",
    "printCityBlocks(ArrayList, HashMap)": "10",
    "IndustrialLayout(ArrayList, int)": "11"
  },
  "methodsBrief": [
    "private HashMap<SVNFile, Integer> getFileCount(ArrayList<SVNFile> files){}",
    "private int getChangesForFileBeforeDate(SVNFile file, Timestamp timestamp){}",
    "public void setLastEditorAndTimeLastModifiedBeforeDate(SVNFile file, Timestamp timestamp){}",
    "public void setTimeCreatedBeforeDate(SVNFile file, Timestamp timestamp){}",
    "private ArrayList<Integer> decreaseIndices(ArrayList<Integer> indices){}",
    "public double[][] getSupportDistanceMatrix(int totalChangesets){}",
    "public double[][] getCosineDistanceMatrix(int totalChangesets){}",
    "public static void printDistanceMatrix(double[][] distanceMatrix)\r\n\t\t\tthrows IOException{}",
    "private HashMap<User, Double> getUserContributionBeforeDate(SVNFile file, Timestamp timestamp, ArrayList<User> users){}",
    "public void prepareToWriteCitySnapshots(Timestamp start, Timestamp end){}",
    "public static void printCityBlocks(ArrayList<CityBlock> blocks, HashMap<SVNFile, Integer> fileCount)\r\n\t\t\tthrows IOException{}",
    "public IndustrialLayout(ArrayList<ChangeSet> changesets, int projectid) throws IOException{}"
  ],
  "constructorSigs": [
    "IndustrialLayout(ArrayList, int)"
  ],
  "constructorBrief": [
    "public IndustrialLayout(ArrayList<ChangeSet> changesets, int projectid) throws IOException{}"
  ],
  "getterSetterSigs": [
    "setLastEditorAndTimeLastModifiedBeforeDate(SVNFile, Timestamp)",
    "setTimeCreatedBeforeDate(SVNFile, Timestamp)"
  ],
  "getterSetterBrief": [
    "public void setLastEditorAndTimeLastModifiedBeforeDate(SVNFile file, Timestamp timestamp){}",
    "public void setTimeCreatedBeforeDate(SVNFile file, Timestamp timestamp){}"
  ],
  "constructorDeps": {
    "ca.ualberta.cs.serl.wikidev.artifacts.ChangeSet": [
      "getChangesetDetails()"
    ],
    "java.lang.String": [
      "equals(Object)"
    ],
    "ca.ualberta.cs.serl.wikidev.artifacts.ChangeSetDetail": [
      "getKind()",
      "getFilename()",
      "getChangetype()"
    ],
    "ca.ualberta.cs.serl.wikidev.artifacts.SVNFile": [
      "addUser(User)",
      "setType()",
      "setDeleted(boolean)",
      "increaseChanges()"
    ],
    "ca.ualberta.cs.serl.wikidev.artifacts.IArtifact": [
      "getOwner()"
    ],
    "java.util.ArrayList": [
      "get(int)",
      "addAll(Collection<? extends E>)",
      "removeAll(Object>)",
      "contains(Object)",
      "add(E)",
      "size()"
    ],
    "java.util.HashMap": [
      "put(K, V)"
    ],
    "ca.ualberta.cs.serl.wikidev.city3d.IndustrialLayout": [
      "decreaseIndices(Integer>)",
      "getFileCount(SVNFile>)",
      "getCosineDistanceMatrix(int)"
    ],
    "java.io.PrintStream": [
      "println(int)"
    ],
    "ca.ualberta.cs.serl.wikidev.city3d.Layout": [
      "getLayout(IArtifact>, double[][])"
    ]
  },
  "compilationUnitCode": "package ca.ualberta.cs.serl.wikidev.city3d;\n\nimport java.io.BufferedWriter;\nimport java.io.FileWriter;\nimport java.io.IOException;\nimport java.sql.SQLException;\nimport java.sql.Timestamp;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.TreeSet;\nimport ca.ualberta.cs.serl.wikidev.DataManager;\nimport ca.ualberta.cs.serl.wikidev.User;\nimport ca.ualberta.cs.serl.wikidev.artifacts.ChangeSet;\nimport ca.ualberta.cs.serl.wikidev.artifacts.ChangeSetDetail;\nimport ca.ualberta.cs.serl.wikidev.artifacts.IArtifact;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Message;\nimport ca.ualberta.cs.serl.wikidev.artifacts.SVNFile;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Ticket;\nimport ca.ualberta.cs.serl.wikidev.artifacts.Wiki;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.CommunicationBuildingData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.FileBuildingData;\nimport ca.ualberta.cs.serl.wikidev.city3d.animation.UserData;\nimport static org.math.array.DoubleArray.deleteRows;\nimport static org.math.array.DoubleArray.deleteColumns;\n\npublic class IndustrialLayout extends Layout {\n\n    public static final String CITY_TYPE = \"files\";\n\n    private HashMap<ChangeSet, ArrayList<SVNFile>> filesPerChangeset;\n\n    private ArrayList<SVNFile> totalFiles;\n\n    private ArrayList<ChangeSet> changesets;\n\n    private int projectid;\n\n    public IndustrialLayout(ArrayList<ChangeSet> changesets, int projectid) throws IOException {\n        this.projectid = projectid;\n        this.changesets = changesets;\n        this.totalFiles = new ArrayList<SVNFile>();\n        this.filesPerChangeset = new HashMap<ChangeSet, ArrayList<SVNFile>>();\n        for (ChangeSet changeset : changesets) {\n            ArrayList<SVNFile> fileList = new ArrayList<SVNFile>();\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getKind().equals(\"file\")) {\n                    SVNFile file = new SVNFile(detail.getFilename());\n                    file.increaseChanges();\n                    if (detail.getChangetype().equals(\"deleted\")) {\n                        file.setDeleted(true);\n                    }\n                    file.addUser(changeset.getOwner());\n                    file.setType();\n                    fileList.add(file);\n                    if (!totalFiles.contains(file)) {\n                        this.totalFiles.add(file);\n                    }\n                }\n            }\n            this.filesPerChangeset.put(changeset, fileList);\n        }\n        double[][] distanceMatrix = getCosineDistanceMatrix(changesets.size());\n        /*try {\n\t\t\tprintDistanceMatrix(distanceMatrix);\n\t\t} catch (IOException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t}*/\n        ArrayList<Integer> indicesToDelete = new ArrayList<Integer>();\n        for (int i = 0; i < distanceMatrix.length; i++) {\n            int count = 0;\n            for (int j = 0; j < distanceMatrix.length; j++) {\n                if (distanceMatrix[i][j] == 1) {\n                    count++;\n                }\n            }\n            if (count == distanceMatrix.length - 1) {\n                indicesToDelete.add(i);\n            }\n        }\n        ArrayList<Integer> originalIndices = new ArrayList<Integer>();\n        originalIndices.addAll(indicesToDelete);\n        for (int i = 0; i < indicesToDelete.size(); i++) {\n            distanceMatrix = deleteRows(distanceMatrix, indicesToDelete.get(i));\n            distanceMatrix = deleteColumns(distanceMatrix, indicesToDelete.get(i));\n            indicesToDelete = decreaseIndices(indicesToDelete);\n        }\n        ArrayList<IArtifact> fileArtifacts = new ArrayList<IArtifact>();\n        ArrayList<SVNFile> removedFiles = new ArrayList<SVNFile>();\n        for (int i = 0; i < totalFiles.size(); i++) {\n            if (!originalIndices.contains(i)) {\n                fileArtifacts.add(totalFiles.get(i));\n            } else {\n                removedFiles.add(totalFiles.get(i));\n            }\n        }\n        totalFiles.removeAll(removedFiles);\n        System.out.println(fileArtifacts.size());\n        this.getLayout(fileArtifacts, distanceMatrix);\n        HashMap<SVNFile, Integer> fileCount = getFileCount(totalFiles);\n        // printCityBlocks(cityBlocks, fileCount);\n        /*\n\t\t * for(int i=0; i<distanceMatrix.length; i++) { for(int j=0;\n\t\t * j<distanceMatrix.length; j++) {\n\t\t * System.out.print(distanceMatrix[i][j]+\"\\t\"); } System.out.println();\n\t\t * }\n\t\t */\n    }\n\n    private HashMap<SVNFile, Integer> getFileCount(ArrayList<SVNFile> files) {\n        HashMap<SVNFile, Integer> fileCount = new HashMap<SVNFile, Integer>();\n        for (SVNFile file : files) {\n            int count = 0;\n            for (ChangeSet changeset : changesets) {\n                for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                    if (detail.getFilename().equals(file.getName())) {\n                        count++;\n                    }\n                }\n            }\n            fileCount.put(file, count);\n        }\n        return fileCount;\n    }\n\n    private int getChangesForFileBeforeDate(SVNFile file, Timestamp timestamp) {\n        int count = 0;\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp)) {\n                    count++;\n                }\n            }\n        }\n        return count;\n    }\n\n    public void setLastEditorAndTimeLastModifiedBeforeDate(SVNFile file, Timestamp timestamp) {\n        file.setLastModified(file.getCreated());\n        file.setLastEditor(file.getOwner());\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp) && detail.getTimestamp().after(file.getLastModified())) {\n                    file.setLastModified(detail.getTimestamp());\n                    file.setLastEditor(detail.getOwner());\n                }\n            }\n        }\n    }\n\n    public void setTimeCreatedBeforeDate(SVNFile file, Timestamp timestamp) {\n        file.setCreated(Timestamp.valueOf(\"2015-01-01 00:00:00\"));\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp) && detail.getTimestamp().before(file.getCreated())) {\n                    file.setCreated(detail.getTimestamp());\n                    file.setOwner(changeset.getOwner());\n                }\n            }\n        }\n    }\n\n    private ArrayList<Integer> decreaseIndices(ArrayList<Integer> indices) {\n        for (int i = 0; i < indices.size(); i++) {\n            indices.set(i, indices.get(i) - 1);\n        }\n        return indices;\n    }\n\n    public double[][] getSupportDistanceMatrix(int totalChangesets) {\n        double[][] distanceMatrix = new double[totalFiles.size()][totalFiles.size()];\n        int i = 0;\n        int j = 0;\n        for (SVNFile file : totalFiles) {\n            for (SVNFile file2 : totalFiles) {\n                if (!file.equals(file2)) {\n                    double count = 0;\n                    for (ChangeSet changeset : filesPerChangeset.keySet()) {\n                        if (filesPerChangeset.get(changeset).contains(file) && filesPerChangeset.get(changeset).contains(file2)) {\n                            count++;\n                        }\n                    }\n                    distanceMatrix[i][j] = 1 - count / totalChangesets;\n                } else {\n                    distanceMatrix[i][j] = 0;\n                }\n                j++;\n            }\n            i++;\n            j = 0;\n        }\n        return distanceMatrix;\n    }\n\n    public double[][] getCosineDistanceMatrix(int totalChangesets) {\n        double[][] distanceMatrix = new double[totalFiles.size()][totalFiles.size()];\n        int i = 0;\n        int j = 0;\n        for (SVNFile file : totalFiles) {\n            for (SVNFile file2 : totalFiles) {\n                if (!file.equals(file2)) {\n                    double count = 0;\n                    for (ChangeSet changeset : filesPerChangeset.keySet()) {\n                        if (filesPerChangeset.get(changeset).contains(file) && filesPerChangeset.get(changeset).contains(file2)) {\n                            count++;\n                        }\n                    }\n                    distanceMatrix[i][j] = count;\n                } else {\n                    distanceMatrix[i][j] = 1;\n                }\n                j++;\n            }\n            i++;\n            j = 0;\n        }\n        double[][] cosineDistance = new double[totalFiles.size()][totalFiles.size()];\n        for (int k = 0; k < totalFiles.size(); k++) {\n            double[] vector1 = distanceMatrix[k];\n            for (int l = 0; l < totalFiles.size(); l++) {\n                if (l != k) {\n                    double[] vector2 = distanceMatrix[l];\n                    double sum = 0;\n                    double norm1 = 0;\n                    double norm2 = 0;\n                    for (int m = 0; m < totalFiles.size(); m++) {\n                        sum += vector1[m] * vector2[m];\n                        norm1 += Math.pow(vector1[m], 2);\n                        norm2 += Math.pow(vector2[m], 2);\n                    }\n                    cosineDistance[k][l] = 1 - sum / (Math.sqrt(norm1) * Math.sqrt(norm2));\n                }\n            }\n        }\n        return cosineDistance;\n    }\n\n    public static void printDistanceMatrix(double[][] distanceMatrix) throws IOException {\n        // BufferedWriter out = new BufferedWriter(new\n        // FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\ucosp\\\\clusters\"+week+\".txt\"));\n        BufferedWriter out = new BufferedWriter(new FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\c301f09\\\\distances.txt\"));\n        for (int i = 0; i < distanceMatrix.length; i++) {\n            for (int j = 0; j < distanceMatrix.length; j++) {\n                out.write(distanceMatrix[i][j] + \"\\t\");\n            }\n            out.newLine();\n        }\n        out.close();\n    }\n\n    private HashMap<User, Double> getUserContributionBeforeDate(SVNFile file, Timestamp timestamp, ArrayList<User> users) {\n        HashMap<User, Double> userChanges = new HashMap<User, Double>();\n        for (User user : users) {\n            userChanges.put(user, 0.0);\n        }\n        int count = 0;\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp)) {\n                    count++;\n                    for (User user : users) {\n                        if (detail.getOwner().equals(user)) {\n                            userChanges.put(user, userChanges.get(user) + 1.0);\n                        }\n                    }\n                }\n            }\n        }\n        for (User user : userChanges.keySet()) {\n            if (count != 0) {\n                userChanges.put(user, userChanges.get(user) / (double) count);\n            }\n        }\n        return userChanges;\n    }\n\n    public void prepareToWriteCitySnapshots(Timestamp start, Timestamp end) {\n        Timestamp firstWeek = new Timestamp(start.getTime() + DataManager.WEEK_INTERVAL_IN_MILLIS);\n        for (long l = firstWeek.getTime(); l < end.getTime() + DataManager.WEEK_INTERVAL_IN_MILLIS; l += DataManager.WEEK_INTERVAL_IN_MILLIS) {\n            if (l > end.getTime()) {\n                l = end.getTime();\n            }\n            Timestamp nextWeek = new Timestamp(l);\n            for (CityBlock block : cityBlocks) {\n                for (IArtifact artifact : block.getArtifacts().keySet()) {\n                    String type = \"\";\n                    int height = 0;\n                    HashMap<User, Double> userContribution = null;\n                    int id = 0;\n                    String url = \"\";\n                    User lastEditor = null;\n                    Timestamp created = null;\n                    Timestamp lastModified = null;\n                    if (artifact instanceof SVNFile) {\n                        SVNFile file = (SVNFile) artifact;\n                        type += file.getType();\n                        height = getChangesForFileBeforeDate(file, nextWeek);\n                        try {\n                            url = URLprefix + DataManager.getProjectByID(projectid).getProjectName() + \"_File:\" + file.getName();\n                        } catch (SQLException e) {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                        userContribution = getUserContributionBeforeDate(file, nextWeek, getUsers(projectid));\n                        this.setTimeCreatedBeforeDate(file, nextWeek);\n                        this.setLastEditorAndTimeLastModifiedBeforeDate(file, nextWeek);\n                        lastEditor = file.getLastEditor();\n                        created = file.getCreated();\n                        lastModified = file.getLastModified();\n                    }\n                    ArrayList<UserData> userData = new ArrayList<UserData>();\n                    for (User user : userContribution.keySet()) {\n                        userData.add(new UserData(user.getUserName(), user.getColor().getRed(), user.getColor().getGreen(), user.getColor().getBlue(), userContribution.get(user), nextWeek, IndustrialLayout.CITY_TYPE));\n                    }\n                    FileBuildingData building = new FileBuildingData(type, nextWeek, height, block.getIndex().x, block.getIndex().y, block.getArtifacts().get(artifact), url, projectid, userData, lastEditor, created, lastModified);\n                    System.out.println(\"Writing \" + building.getUrl());\n                    try {\n                        DataManager.writeFilesBuildingData(building);\n                    } catch (SQLException e) {\n                        // TODO Auto-generated catch block\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n    }\n\n    public static void printCityBlocks(ArrayList<CityBlock> blocks, HashMap<SVNFile, Integer> fileCount) throws IOException {\n        // BufferedWriter out = new BufferedWriter(new\n        // FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\ucosp\\\\clusters\"+week+\".txt\"));\n        BufferedWriter out = new BufferedWriter(new FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\c301f09\\\\industrialBlocks.txt\"));\n        int index = 1;\n        out.write(\"\" + Math.sqrt(blocks.size()));\n        out.newLine();\n        for (CityBlock block : blocks) {\n            for (IArtifact artifact : block.getArtifacts().keySet()) {\n                String type = \"\" + index + \"\\t\";\n                int height = 0;\n                String line = \"\";\n                if (artifact instanceof SVNFile) {\n                    SVNFile file = (SVNFile) artifact;\n                    type += file.getType();\n                    height = fileCount.get(file);\n                    line += type + \"\\t\" + block.getIndex().x + \"\\t\" + block.getIndex().y + \"\\t\" + block.getArtifacts().get(artifact) + \"\\t\" + height + \"\\t\";\n                    for (User user : file.getUsers()) {\n                        line += \"<\" + user.getUserName() + \", \" + user.getColor().getRed() + \", \" + user.getColor().getGreen() + \", \" + user.getColor().getBlue() + \"> \\t\";\n                    }\n                }\n                out.write(line);\n                out.newLine();\n                index++;\n            }\n        }\n        out.close();\n    }\n}\n",
  "classDeclarationCode": "public class IndustrialLayout extends Layout {\n\n    public static final String CITY_TYPE = \"files\";\n\n    private HashMap<ChangeSet, ArrayList<SVNFile>> filesPerChangeset;\n\n    private ArrayList<SVNFile> totalFiles;\n\n    private ArrayList<ChangeSet> changesets;\n\n    private int projectid;\n\n    public IndustrialLayout(ArrayList<ChangeSet> changesets, int projectid) throws IOException {\n        this.projectid = projectid;\n        this.changesets = changesets;\n        this.totalFiles = new ArrayList<SVNFile>();\n        this.filesPerChangeset = new HashMap<ChangeSet, ArrayList<SVNFile>>();\n        for (ChangeSet changeset : changesets) {\n            ArrayList<SVNFile> fileList = new ArrayList<SVNFile>();\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getKind().equals(\"file\")) {\n                    SVNFile file = new SVNFile(detail.getFilename());\n                    file.increaseChanges();\n                    if (detail.getChangetype().equals(\"deleted\")) {\n                        file.setDeleted(true);\n                    }\n                    file.addUser(changeset.getOwner());\n                    file.setType();\n                    fileList.add(file);\n                    if (!totalFiles.contains(file)) {\n                        this.totalFiles.add(file);\n                    }\n                }\n            }\n            this.filesPerChangeset.put(changeset, fileList);\n        }\n        double[][] distanceMatrix = getCosineDistanceMatrix(changesets.size());\n        /*try {\n\t\t\tprintDistanceMatrix(distanceMatrix);\n\t\t} catch (IOException e) {\n\t\t\t// TODO Auto-generated catch block\n\t\t\te.printStackTrace();\n\t\t}*/\n        ArrayList<Integer> indicesToDelete = new ArrayList<Integer>();\n        for (int i = 0; i < distanceMatrix.length; i++) {\n            int count = 0;\n            for (int j = 0; j < distanceMatrix.length; j++) {\n                if (distanceMatrix[i][j] == 1) {\n                    count++;\n                }\n            }\n            if (count == distanceMatrix.length - 1) {\n                indicesToDelete.add(i);\n            }\n        }\n        ArrayList<Integer> originalIndices = new ArrayList<Integer>();\n        originalIndices.addAll(indicesToDelete);\n        for (int i = 0; i < indicesToDelete.size(); i++) {\n            distanceMatrix = deleteRows(distanceMatrix, indicesToDelete.get(i));\n            distanceMatrix = deleteColumns(distanceMatrix, indicesToDelete.get(i));\n            indicesToDelete = decreaseIndices(indicesToDelete);\n        }\n        ArrayList<IArtifact> fileArtifacts = new ArrayList<IArtifact>();\n        ArrayList<SVNFile> removedFiles = new ArrayList<SVNFile>();\n        for (int i = 0; i < totalFiles.size(); i++) {\n            if (!originalIndices.contains(i)) {\n                fileArtifacts.add(totalFiles.get(i));\n            } else {\n                removedFiles.add(totalFiles.get(i));\n            }\n        }\n        totalFiles.removeAll(removedFiles);\n        System.out.println(fileArtifacts.size());\n        this.getLayout(fileArtifacts, distanceMatrix);\n        HashMap<SVNFile, Integer> fileCount = getFileCount(totalFiles);\n        // printCityBlocks(cityBlocks, fileCount);\n        /*\n\t\t * for(int i=0; i<distanceMatrix.length; i++) { for(int j=0;\n\t\t * j<distanceMatrix.length; j++) {\n\t\t * System.out.print(distanceMatrix[i][j]+\"\\t\"); } System.out.println();\n\t\t * }\n\t\t */\n    }\n\n    private HashMap<SVNFile, Integer> getFileCount(ArrayList<SVNFile> files) {\n        HashMap<SVNFile, Integer> fileCount = new HashMap<SVNFile, Integer>();\n        for (SVNFile file : files) {\n            int count = 0;\n            for (ChangeSet changeset : changesets) {\n                for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                    if (detail.getFilename().equals(file.getName())) {\n                        count++;\n                    }\n                }\n            }\n            fileCount.put(file, count);\n        }\n        return fileCount;\n    }\n\n    private int getChangesForFileBeforeDate(SVNFile file, Timestamp timestamp) {\n        int count = 0;\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp)) {\n                    count++;\n                }\n            }\n        }\n        return count;\n    }\n\n    public void setLastEditorAndTimeLastModifiedBeforeDate(SVNFile file, Timestamp timestamp) {\n        file.setLastModified(file.getCreated());\n        file.setLastEditor(file.getOwner());\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp) && detail.getTimestamp().after(file.getLastModified())) {\n                    file.setLastModified(detail.getTimestamp());\n                    file.setLastEditor(detail.getOwner());\n                }\n            }\n        }\n    }\n\n    public void setTimeCreatedBeforeDate(SVNFile file, Timestamp timestamp) {\n        file.setCreated(Timestamp.valueOf(\"2015-01-01 00:00:00\"));\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp) && detail.getTimestamp().before(file.getCreated())) {\n                    file.setCreated(detail.getTimestamp());\n                    file.setOwner(changeset.getOwner());\n                }\n            }\n        }\n    }\n\n    private ArrayList<Integer> decreaseIndices(ArrayList<Integer> indices) {\n        for (int i = 0; i < indices.size(); i++) {\n            indices.set(i, indices.get(i) - 1);\n        }\n        return indices;\n    }\n\n    public double[][] getSupportDistanceMatrix(int totalChangesets) {\n        double[][] distanceMatrix = new double[totalFiles.size()][totalFiles.size()];\n        int i = 0;\n        int j = 0;\n        for (SVNFile file : totalFiles) {\n            for (SVNFile file2 : totalFiles) {\n                if (!file.equals(file2)) {\n                    double count = 0;\n                    for (ChangeSet changeset : filesPerChangeset.keySet()) {\n                        if (filesPerChangeset.get(changeset).contains(file) && filesPerChangeset.get(changeset).contains(file2)) {\n                            count++;\n                        }\n                    }\n                    distanceMatrix[i][j] = 1 - count / totalChangesets;\n                } else {\n                    distanceMatrix[i][j] = 0;\n                }\n                j++;\n            }\n            i++;\n            j = 0;\n        }\n        return distanceMatrix;\n    }\n\n    public double[][] getCosineDistanceMatrix(int totalChangesets) {\n        double[][] distanceMatrix = new double[totalFiles.size()][totalFiles.size()];\n        int i = 0;\n        int j = 0;\n        for (SVNFile file : totalFiles) {\n            for (SVNFile file2 : totalFiles) {\n                if (!file.equals(file2)) {\n                    double count = 0;\n                    for (ChangeSet changeset : filesPerChangeset.keySet()) {\n                        if (filesPerChangeset.get(changeset).contains(file) && filesPerChangeset.get(changeset).contains(file2)) {\n                            count++;\n                        }\n                    }\n                    distanceMatrix[i][j] = count;\n                } else {\n                    distanceMatrix[i][j] = 1;\n                }\n                j++;\n            }\n            i++;\n            j = 0;\n        }\n        double[][] cosineDistance = new double[totalFiles.size()][totalFiles.size()];\n        for (int k = 0; k < totalFiles.size(); k++) {\n            double[] vector1 = distanceMatrix[k];\n            for (int l = 0; l < totalFiles.size(); l++) {\n                if (l != k) {\n                    double[] vector2 = distanceMatrix[l];\n                    double sum = 0;\n                    double norm1 = 0;\n                    double norm2 = 0;\n                    for (int m = 0; m < totalFiles.size(); m++) {\n                        sum += vector1[m] * vector2[m];\n                        norm1 += Math.pow(vector1[m], 2);\n                        norm2 += Math.pow(vector2[m], 2);\n                    }\n                    cosineDistance[k][l] = 1 - sum / (Math.sqrt(norm1) * Math.sqrt(norm2));\n                }\n            }\n        }\n        return cosineDistance;\n    }\n\n    public static void printDistanceMatrix(double[][] distanceMatrix) throws IOException {\n        // BufferedWriter out = new BufferedWriter(new\n        // FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\ucosp\\\\clusters\"+week+\".txt\"));\n        BufferedWriter out = new BufferedWriter(new FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\c301f09\\\\distances.txt\"));\n        for (int i = 0; i < distanceMatrix.length; i++) {\n            for (int j = 0; j < distanceMatrix.length; j++) {\n                out.write(distanceMatrix[i][j] + \"\\t\");\n            }\n            out.newLine();\n        }\n        out.close();\n    }\n\n    private HashMap<User, Double> getUserContributionBeforeDate(SVNFile file, Timestamp timestamp, ArrayList<User> users) {\n        HashMap<User, Double> userChanges = new HashMap<User, Double>();\n        for (User user : users) {\n            userChanges.put(user, 0.0);\n        }\n        int count = 0;\n        for (ChangeSet changeset : changesets) {\n            for (ChangeSetDetail detail : changeset.getChangesetDetails()) {\n                if (detail.getFilename().equals(file.getName()) && detail.getTimestamp().before(timestamp)) {\n                    count++;\n                    for (User user : users) {\n                        if (detail.getOwner().equals(user)) {\n                            userChanges.put(user, userChanges.get(user) + 1.0);\n                        }\n                    }\n                }\n            }\n        }\n        for (User user : userChanges.keySet()) {\n            if (count != 0) {\n                userChanges.put(user, userChanges.get(user) / (double) count);\n            }\n        }\n        return userChanges;\n    }\n\n    public void prepareToWriteCitySnapshots(Timestamp start, Timestamp end) {\n        Timestamp firstWeek = new Timestamp(start.getTime() + DataManager.WEEK_INTERVAL_IN_MILLIS);\n        for (long l = firstWeek.getTime(); l < end.getTime() + DataManager.WEEK_INTERVAL_IN_MILLIS; l += DataManager.WEEK_INTERVAL_IN_MILLIS) {\n            if (l > end.getTime()) {\n                l = end.getTime();\n            }\n            Timestamp nextWeek = new Timestamp(l);\n            for (CityBlock block : cityBlocks) {\n                for (IArtifact artifact : block.getArtifacts().keySet()) {\n                    String type = \"\";\n                    int height = 0;\n                    HashMap<User, Double> userContribution = null;\n                    int id = 0;\n                    String url = \"\";\n                    User lastEditor = null;\n                    Timestamp created = null;\n                    Timestamp lastModified = null;\n                    if (artifact instanceof SVNFile) {\n                        SVNFile file = (SVNFile) artifact;\n                        type += file.getType();\n                        height = getChangesForFileBeforeDate(file, nextWeek);\n                        try {\n                            url = URLprefix + DataManager.getProjectByID(projectid).getProjectName() + \"_File:\" + file.getName();\n                        } catch (SQLException e) {\n                            // TODO Auto-generated catch block\n                            e.printStackTrace();\n                        }\n                        userContribution = getUserContributionBeforeDate(file, nextWeek, getUsers(projectid));\n                        this.setTimeCreatedBeforeDate(file, nextWeek);\n                        this.setLastEditorAndTimeLastModifiedBeforeDate(file, nextWeek);\n                        lastEditor = file.getLastEditor();\n                        created = file.getCreated();\n                        lastModified = file.getLastModified();\n                    }\n                    ArrayList<UserData> userData = new ArrayList<UserData>();\n                    for (User user : userContribution.keySet()) {\n                        userData.add(new UserData(user.getUserName(), user.getColor().getRed(), user.getColor().getGreen(), user.getColor().getBlue(), userContribution.get(user), nextWeek, IndustrialLayout.CITY_TYPE));\n                    }\n                    FileBuildingData building = new FileBuildingData(type, nextWeek, height, block.getIndex().x, block.getIndex().y, block.getArtifacts().get(artifact), url, projectid, userData, lastEditor, created, lastModified);\n                    System.out.println(\"Writing \" + building.getUrl());\n                    try {\n                        DataManager.writeFilesBuildingData(building);\n                    } catch (SQLException e) {\n                        // TODO Auto-generated catch block\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n    }\n\n    public static void printCityBlocks(ArrayList<CityBlock> blocks, HashMap<SVNFile, Integer> fileCount) throws IOException {\n        // BufferedWriter out = new BufferedWriter(new\n        // FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\ucosp\\\\clusters\"+week+\".txt\"));\n        BufferedWriter out = new BufferedWriter(new FileWriter(\"C:\\\\Documents and Settings\\\\Marios Fokaefs\\\\Desktop\\\\wikidev-files\\\\c301f09\\\\industrialBlocks.txt\"));\n        int index = 1;\n        out.write(\"\" + Math.sqrt(blocks.size()));\n        out.newLine();\n        for (CityBlock block : blocks) {\n            for (IArtifact artifact : block.getArtifacts().keySet()) {\n                String type = \"\" + index + \"\\t\";\n                int height = 0;\n                String line = \"\";\n                if (artifact instanceof SVNFile) {\n                    SVNFile file = (SVNFile) artifact;\n                    type += file.getType();\n                    height = fileCount.get(file);\n                    line += type + \"\\t\" + block.getIndex().x + \"\\t\" + block.getIndex().y + \"\\t\" + block.getArtifacts().get(artifact) + \"\\t\" + height + \"\\t\";\n                    for (User user : file.getUsers()) {\n                        line += \"<\" + user.getUserName() + \", \" + user.getColor().getRed() + \", \" + user.getColor().getGreen() + \", \" + user.getColor().getBlue() + \"> \\t\";\n                    }\n                }\n                out.write(line);\n                out.newLine();\n                index++;\n            }\n        }\n        out.close();\n    }\n}",
  "subClasses": []
}