{
  "fullClassName": "CH.ifa.draw.standard.ConnectionTool",
  "className": "ConnectionTool",
  "index": 117,
  "modifier": "[public ]",
  "extend": "[AbstractTool]",
  "implement": "[]",
  "packageName": "CH.ifa.draw.standard",
  "packageDeclaration": "package CH.ifa.draw.standard;",
  "classSignature": "public  class ConnectionTool",
  "hasConstructor": true,
  "isPublic": true,
  "isInterface": false,
  "isAbstract": false,
  "imports": [
    "import java.awt.*;",
    "import java.awt.event.MouseEvent;",
    "import java.util.*;",
    "import CH.ifa.draw.framework.*;",
    "import CH.ifa.draw.util.Geom;"
  ],
  "fields": [
    "private Connector   fStartConnector;",
    "private Connector   fEndConnector;",
    "private Connector   fConnectorTarget = null;",
    "private Figure fTarget = null;",
    "private ConnectionFigure  fConnection;",
    "private int  fSplitPoint;",
    "private ConnectionFigure  fEditedConnection = null;",
    "private ConnectionFigure  fPrototype;"
  ],
  "superClasses": [
    "AbstractTool"
  ],
  "implementedTypes": [],
  "methodSigs": {
    "mouseMove(MouseEvent, int, int)": "0",
    "mouseDown(MouseEvent, int, int)": "1",
    "mouseDrag(MouseEvent, int, int)": "2",
    "mouseUp(MouseEvent, int, int)": "3",
    "deactivate()": "4",
    "createConnection()": "5",
    "findSource(int, int, Drawing)": "6",
    "findTarget(int, int, Drawing)": "7",
    "findConnection(int, int, Drawing)": "8",
    "createdFigure()": "9",
    "trackConnectors(MouseEvent, int, int)": "10",
    "findConnector(int, int, Figure)": "11",
    "findConnectionStart(int, int, Drawing)": "12",
    "findConnectableFigure(int, int, Drawing)": "13",
    "getStartConnector()": "14",
    "getEndConnector()": "15",
    "getTarget()": "16",
    "ConnectionTool(DrawingView, ConnectionFigure)": "17"
  },
  "methodsBrief": [
    "public void mouseMove(MouseEvent e, int x, int y){}",
    "public void mouseDown(MouseEvent e, int x, int y)\r\n   {}",
    "public void mouseDrag(MouseEvent e, int x, int y){}",
    "public void mouseUp(MouseEvent e, int x, int y){}",
    "public void deactivate(){}",
    "protected ConnectionFigure createConnection(){}",
    "protected Figure findSource(int x, int y, Drawing drawing){}",
    "protected Figure findTarget(int x, int y, Drawing drawing){}",
    "protected ConnectionFigure findConnection(int x, int y, Drawing drawing){}",
    "protected ConnectionFigure createdFigure(){}",
    "protected void trackConnectors(MouseEvent e, int x, int y){}",
    "private Connector findConnector(int x, int y, Figure f){}",
    "protected Figure findConnectionStart(int x, int y, Drawing drawing){}",
    "private Figure findConnectableFigure(int x, int y, Drawing drawing){}",
    "protected Connector getStartConnector(){}",
    "protected Connector getEndConnector(){}",
    "protected Connector getTarget(){}",
    "public ConnectionTool(DrawingView view, ConnectionFigure prototype){}"
  ],
  "constructorSigs": [
    "ConnectionTool(DrawingView, ConnectionFigure)"
  ],
  "constructorBrief": [
    "public ConnectionTool(DrawingView view, ConnectionFigure prototype){}"
  ],
  "getterSetterSigs": [
    "getStartConnector()",
    "getEndConnector()",
    "getTarget()"
  ],
  "getterSetterBrief": [
    "protected Connector getStartConnector(){}",
    "protected Connector getEndConnector(){}",
    "protected Connector getTarget(){}"
  ],
  "constructorDeps": {
    "CH.ifa.draw.framework.DrawingView": [],
    "CH.ifa.draw.framework.ConnectionFigure": []
  },
  "compilationUnitCode": "/*\n * @(#)ConnectionTool.java 5.2\n *\n */\npackage CH.ifa.draw.standard;\n\nimport java.awt.*;\nimport java.awt.event.MouseEvent;\nimport java.util.*;\nimport CH.ifa.draw.framework.*;\nimport CH.ifa.draw.util.Geom;\n\n/**\n * A tool that can be used to connect figures, to split\n * connections, and to join two segments of a connection.\n * ConnectionTools turns the visibility of the Connectors\n * on when it enters a figure.\n * The connection object to be created is specified by a prototype.\n * <hr>\n * <b>Design Patterns</b><P>\n * <img src=\"images/red-ball-small.gif\" width=6 height=6 alt=\" o \">\n * <b><a href=../pattlets/sld029.htm>Prototype</a></b><br>\n * ConnectionTools creates the connection by cloning a prototype.\n * <hr>\n *\n * @see ConnectionFigure\n * @see Object#clone\n */\npublic class ConnectionTool extends AbstractTool {\n\n    /**\n     * the anchor point of the interaction\n     */\n    private Connector fStartConnector;\n\n    private Connector fEndConnector;\n\n    private Connector fConnectorTarget = null;\n\n    private Figure fTarget = null;\n\n    /**\n     * the currently created figure\n     */\n    private ConnectionFigure fConnection;\n\n    /**\n     * the currently manipulated connection point\n     */\n    private int fSplitPoint;\n\n    /**\n     * the currently edited connection\n     */\n    private ConnectionFigure fEditedConnection = null;\n\n    /**\n     * the prototypical figure that is used to create new\n     * connections.\n     */\n    private ConnectionFigure fPrototype;\n\n    public ConnectionTool(DrawingView view, ConnectionFigure prototype) {\n        super(view);\n        fPrototype = prototype;\n    }\n\n    /**\n     * Handles mouse move events in the drawing view.\n     */\n    public void mouseMove(MouseEvent e, int x, int y) {\n        trackConnectors(e, x, y);\n    }\n\n    /**\n     * Manipulates connections in a context dependent way. If the\n     * mouse down hits a figure start a new connection. If the mousedown\n     * hits a connection split a segment or join two segments.\n     */\n    public void mouseDown(MouseEvent e, int x, int y) {\n        int ex = e.getX();\n        int ey = e.getY();\n        fTarget = findConnectionStart(ex, ey, drawing());\n        if (fTarget != null) {\n            fStartConnector = findConnector(ex, ey, fTarget);\n            if (fStartConnector != null) {\n                Point p = new Point(ex, ey);\n                fConnection = createConnection();\n                fConnection.startPoint(p.x, p.y);\n                fConnection.endPoint(p.x, p.y);\n                view().add(fConnection);\n            }\n        } else {\n            ConnectionFigure connection = findConnection(ex, ey, drawing());\n            if (connection != null) {\n                if (!connection.joinSegments(ex, ey)) {\n                    fSplitPoint = connection.splitSegment(ex, ey);\n                    fEditedConnection = connection;\n                } else {\n                    fEditedConnection = null;\n                }\n            }\n        }\n    }\n\n    /**\n     * Adjust the created connection or split segment.\n     */\n    public void mouseDrag(MouseEvent e, int x, int y) {\n        Point p = new Point(e.getX(), e.getY());\n        if (fConnection != null) {\n            Figure c = null;\n            if (fStartConnector == null)\n                c = findSource(x, y, drawing());\n            else\n                c = findTarget(x, y, drawing());\n            // track the figure containing the mouse\n            if (c != fTarget) {\n                if (fTarget != null)\n                    fTarget.connectorVisibility(false);\n                fTarget = c;\n                if (fTarget != null)\n                    fTarget.connectorVisibility(true);\n            }\n            Connector cc = null;\n            if (c != null)\n                cc = findConnector(e.getX(), e.getY(), c);\n            if (cc != fConnectorTarget)\n                fConnectorTarget = cc;\n            view().checkDamage();\n            if (fConnectorTarget != null)\n                p = Geom.center(fConnectorTarget.displayBox());\n            fConnection.endPoint(p.x, p.y);\n        } else if (fEditedConnection != null) {\n            Point pp = new Point(x, y);\n            fEditedConnection.setPointAt(pp, fSplitPoint);\n        }\n    }\n\n    /**\n     * Connects the figures if the mouse is released over another\n     * figure.\n     */\n    public void mouseUp(MouseEvent e, int x, int y) {\n        Figure c = null;\n        if (fStartConnector != null)\n            c = findTarget(e.getX(), e.getY(), drawing());\n        if (c != null) {\n            fEndConnector = findConnector(e.getX(), e.getY(), c);\n            if (fEndConnector != null) {\n                fConnection.connectStart(fStartConnector);\n                fConnection.connectEnd(fEndConnector);\n                fConnection.updateConnection();\n            }\n        } else if (fConnection != null)\n            view().remove(fConnection);\n        fConnection = null;\n        fStartConnector = fEndConnector = null;\n        editor().toolDone();\n    }\n\n    public void deactivate() {\n        super.deactivate();\n        if (fTarget != null)\n            fTarget.connectorVisibility(false);\n    }\n\n    /**\n     * Creates the ConnectionFigure. By default the figure prototype is\n     * cloned.\n     */\n    protected ConnectionFigure createConnection() {\n        return (ConnectionFigure) fPrototype.clone();\n    }\n\n    /**\n     * Finds a connectable figure target.\n     */\n    protected Figure findSource(int x, int y, Drawing drawing) {\n        return findConnectableFigure(x, y, drawing);\n    }\n\n    /**\n     * Finds a connectable figure target.\n     */\n    protected Figure findTarget(int x, int y, Drawing drawing) {\n        Figure target = findConnectableFigure(x, y, drawing);\n        Figure start = fStartConnector.owner();\n        if (target != null && fConnection != null && target.canConnect() && !target.includes(start) && fConnection.canConnect(start, target))\n            return target;\n        return null;\n    }\n\n    /**\n     * Finds an existing connection figure.\n     */\n    protected ConnectionFigure findConnection(int x, int y, Drawing drawing) {\n        Enumeration k = drawing.figuresReverse();\n        while (k.hasMoreElements()) {\n            Figure figure = (Figure) k.nextElement();\n            figure = figure.findFigureInside(x, y);\n            if (figure != null && (figure instanceof ConnectionFigure))\n                return (ConnectionFigure) figure;\n        }\n        return null;\n    }\n\n    /**\n     * Gets the currently created figure\n     */\n    protected ConnectionFigure createdFigure() {\n        return fConnection;\n    }\n\n    protected void trackConnectors(MouseEvent e, int x, int y) {\n        Figure c = null;\n        if (fStartConnector == null)\n            c = findSource(x, y, drawing());\n        else\n            c = findTarget(x, y, drawing());\n        // track the figure containing the mouse\n        if (c != fTarget) {\n            if (fTarget != null)\n                fTarget.connectorVisibility(false);\n            fTarget = c;\n            if (fTarget != null)\n                fTarget.connectorVisibility(true);\n        }\n        Connector cc = null;\n        if (c != null)\n            cc = findConnector(e.getX(), e.getY(), c);\n        if (cc != fConnectorTarget)\n            fConnectorTarget = cc;\n        view().checkDamage();\n    }\n\n    private Connector findConnector(int x, int y, Figure f) {\n        return f.connectorAt(x, y);\n    }\n\n    /**\n     * Finds a connection start figure.\n     */\n    protected Figure findConnectionStart(int x, int y, Drawing drawing) {\n        Figure target = findConnectableFigure(x, y, drawing);\n        if ((target != null) && target.canConnect())\n            return target;\n        return null;\n    }\n\n    private Figure findConnectableFigure(int x, int y, Drawing drawing) {\n        FigureEnumeration k = drawing.figuresReverse();\n        while (k.hasMoreElements()) {\n            Figure figure = k.nextFigure();\n            if (!figure.includes(fConnection) && figure.canConnect()) {\n                if (figure.containsPoint(x, y))\n                    return figure;\n            }\n        }\n        return null;\n    }\n\n    protected Connector getStartConnector() {\n        return fStartConnector;\n    }\n\n    protected Connector getEndConnector() {\n        return fEndConnector;\n    }\n\n    protected Connector getTarget() {\n        return fConnectorTarget;\n    }\n}\n",
  "classDeclarationCode": "/**\n * A tool that can be used to connect figures, to split\n * connections, and to join two segments of a connection.\n * ConnectionTools turns the visibility of the Connectors\n * on when it enters a figure.\n * The connection object to be created is specified by a prototype.\n * <hr>\n * <b>Design Patterns</b><P>\n * <img src=\"images/red-ball-small.gif\" width=6 height=6 alt=\" o \">\n * <b><a href=../pattlets/sld029.htm>Prototype</a></b><br>\n * ConnectionTools creates the connection by cloning a prototype.\n * <hr>\n *\n * @see ConnectionFigure\n * @see Object#clone\n */\npublic class ConnectionTool extends AbstractTool {\n\n    /**\n     * the anchor point of the interaction\n     */\n    private Connector fStartConnector;\n\n    private Connector fEndConnector;\n\n    private Connector fConnectorTarget = null;\n\n    private Figure fTarget = null;\n\n    /**\n     * the currently created figure\n     */\n    private ConnectionFigure fConnection;\n\n    /**\n     * the currently manipulated connection point\n     */\n    private int fSplitPoint;\n\n    /**\n     * the currently edited connection\n     */\n    private ConnectionFigure fEditedConnection = null;\n\n    /**\n     * the prototypical figure that is used to create new\n     * connections.\n     */\n    private ConnectionFigure fPrototype;\n\n    public ConnectionTool(DrawingView view, ConnectionFigure prototype) {\n        super(view);\n        fPrototype = prototype;\n    }\n\n    /**\n     * Handles mouse move events in the drawing view.\n     */\n    public void mouseMove(MouseEvent e, int x, int y) {\n        trackConnectors(e, x, y);\n    }\n\n    /**\n     * Manipulates connections in a context dependent way. If the\n     * mouse down hits a figure start a new connection. If the mousedown\n     * hits a connection split a segment or join two segments.\n     */\n    public void mouseDown(MouseEvent e, int x, int y) {\n        int ex = e.getX();\n        int ey = e.getY();\n        fTarget = findConnectionStart(ex, ey, drawing());\n        if (fTarget != null) {\n            fStartConnector = findConnector(ex, ey, fTarget);\n            if (fStartConnector != null) {\n                Point p = new Point(ex, ey);\n                fConnection = createConnection();\n                fConnection.startPoint(p.x, p.y);\n                fConnection.endPoint(p.x, p.y);\n                view().add(fConnection);\n            }\n        } else {\n            ConnectionFigure connection = findConnection(ex, ey, drawing());\n            if (connection != null) {\n                if (!connection.joinSegments(ex, ey)) {\n                    fSplitPoint = connection.splitSegment(ex, ey);\n                    fEditedConnection = connection;\n                } else {\n                    fEditedConnection = null;\n                }\n            }\n        }\n    }\n\n    /**\n     * Adjust the created connection or split segment.\n     */\n    public void mouseDrag(MouseEvent e, int x, int y) {\n        Point p = new Point(e.getX(), e.getY());\n        if (fConnection != null) {\n            Figure c = null;\n            if (fStartConnector == null)\n                c = findSource(x, y, drawing());\n            else\n                c = findTarget(x, y, drawing());\n            // track the figure containing the mouse\n            if (c != fTarget) {\n                if (fTarget != null)\n                    fTarget.connectorVisibility(false);\n                fTarget = c;\n                if (fTarget != null)\n                    fTarget.connectorVisibility(true);\n            }\n            Connector cc = null;\n            if (c != null)\n                cc = findConnector(e.getX(), e.getY(), c);\n            if (cc != fConnectorTarget)\n                fConnectorTarget = cc;\n            view().checkDamage();\n            if (fConnectorTarget != null)\n                p = Geom.center(fConnectorTarget.displayBox());\n            fConnection.endPoint(p.x, p.y);\n        } else if (fEditedConnection != null) {\n            Point pp = new Point(x, y);\n            fEditedConnection.setPointAt(pp, fSplitPoint);\n        }\n    }\n\n    /**\n     * Connects the figures if the mouse is released over another\n     * figure.\n     */\n    public void mouseUp(MouseEvent e, int x, int y) {\n        Figure c = null;\n        if (fStartConnector != null)\n            c = findTarget(e.getX(), e.getY(), drawing());\n        if (c != null) {\n            fEndConnector = findConnector(e.getX(), e.getY(), c);\n            if (fEndConnector != null) {\n                fConnection.connectStart(fStartConnector);\n                fConnection.connectEnd(fEndConnector);\n                fConnection.updateConnection();\n            }\n        } else if (fConnection != null)\n            view().remove(fConnection);\n        fConnection = null;\n        fStartConnector = fEndConnector = null;\n        editor().toolDone();\n    }\n\n    public void deactivate() {\n        super.deactivate();\n        if (fTarget != null)\n            fTarget.connectorVisibility(false);\n    }\n\n    /**\n     * Creates the ConnectionFigure. By default the figure prototype is\n     * cloned.\n     */\n    protected ConnectionFigure createConnection() {\n        return (ConnectionFigure) fPrototype.clone();\n    }\n\n    /**\n     * Finds a connectable figure target.\n     */\n    protected Figure findSource(int x, int y, Drawing drawing) {\n        return findConnectableFigure(x, y, drawing);\n    }\n\n    /**\n     * Finds a connectable figure target.\n     */\n    protected Figure findTarget(int x, int y, Drawing drawing) {\n        Figure target = findConnectableFigure(x, y, drawing);\n        Figure start = fStartConnector.owner();\n        if (target != null && fConnection != null && target.canConnect() && !target.includes(start) && fConnection.canConnect(start, target))\n            return target;\n        return null;\n    }\n\n    /**\n     * Finds an existing connection figure.\n     */\n    protected ConnectionFigure findConnection(int x, int y, Drawing drawing) {\n        Enumeration k = drawing.figuresReverse();\n        while (k.hasMoreElements()) {\n            Figure figure = (Figure) k.nextElement();\n            figure = figure.findFigureInside(x, y);\n            if (figure != null && (figure instanceof ConnectionFigure))\n                return (ConnectionFigure) figure;\n        }\n        return null;\n    }\n\n    /**\n     * Gets the currently created figure\n     */\n    protected ConnectionFigure createdFigure() {\n        return fConnection;\n    }\n\n    protected void trackConnectors(MouseEvent e, int x, int y) {\n        Figure c = null;\n        if (fStartConnector == null)\n            c = findSource(x, y, drawing());\n        else\n            c = findTarget(x, y, drawing());\n        // track the figure containing the mouse\n        if (c != fTarget) {\n            if (fTarget != null)\n                fTarget.connectorVisibility(false);\n            fTarget = c;\n            if (fTarget != null)\n                fTarget.connectorVisibility(true);\n        }\n        Connector cc = null;\n        if (c != null)\n            cc = findConnector(e.getX(), e.getY(), c);\n        if (cc != fConnectorTarget)\n            fConnectorTarget = cc;\n        view().checkDamage();\n    }\n\n    private Connector findConnector(int x, int y, Figure f) {\n        return f.connectorAt(x, y);\n    }\n\n    /**\n     * Finds a connection start figure.\n     */\n    protected Figure findConnectionStart(int x, int y, Drawing drawing) {\n        Figure target = findConnectableFigure(x, y, drawing);\n        if ((target != null) && target.canConnect())\n            return target;\n        return null;\n    }\n\n    private Figure findConnectableFigure(int x, int y, Drawing drawing) {\n        FigureEnumeration k = drawing.figuresReverse();\n        while (k.hasMoreElements()) {\n            Figure figure = k.nextFigure();\n            if (!figure.includes(fConnection) && figure.canConnect()) {\n                if (figure.containsPoint(x, y))\n                    return figure;\n            }\n        }\n        return null;\n    }\n\n    protected Connector getStartConnector() {\n        return fStartConnector;\n    }\n\n    protected Connector getEndConnector() {\n        return fEndConnector;\n    }\n\n    protected Connector getTarget() {\n        return fConnectorTarget;\n    }\n}",
  "subClasses": []
}